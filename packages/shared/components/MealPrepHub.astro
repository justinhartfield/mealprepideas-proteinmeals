---
/**
 * MealPrepHub — Meal Prep Hub Page (Wizard + Filterable Browser)
 * This is the /meal-prep/ hub — distinct from the homepage.
 * Features: Wizard tool, filterable recipe/plan grid, taxonomy navigation
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import FacetNav from './FacetNav.astro';
import { recipes } from '../data/content/recipes';
import { plans } from '../data/content/plans';
import {
  getAverageProtein,
  getAverageMealsPerPlan,
  getAveragePlanBudget,
  getMealPrepRecipeCount,
} from '../utils/stats';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const allMPRecipes = recipes.filter(r => r.hub === 'meal-prep');
const allMPPlans = plans.filter(p => p.hub === 'meal-prep');
const fallbackImage = '/images/placeholder.svg';

// Dynamic stats
const avgProtein = getAverageProtein();
const avgMeals = getAverageMealsPerPlan();
const avgBudget = getAveragePlanBudget();
const mpRecipeCount = getMealPrepRecipeCount();

// Serialize data for Alpine.js
const alpineRecipeData = JSON.stringify(
  allMPRecipes.map(r => ({
    slug: r.slug,
    title: r.title,
    protein: r.protein,
    calories: r.calories,
    imageAlt: r.imageAlt || r.title,
    prepTime: r.prepTime + r.cookTime,
    servings: r.servings,
    meal: r.facets.meal || '',
    method: r.facets.method || '',
    diet: r.facets.diet || '',
    goal: r.facets.goal || '',
    constraint: r.facets.constraint || '',
  }))
);

const alpinePlanData = JSON.stringify(
  allMPPlans.map(p => ({
    slug: p.slug,
    title: p.title,
    description: p.description,
    dailyProtein: p.dailyProtein,
    dailyCalories: p.dailyCalories,
    groceryBudget: p.groceryBudget,
    totalMeals: p.days.reduce((sum, d) => sum + d.meals.length, 0),
  }))
);

// Extract unique filter values
const uniqueMeals = [...new Set(allMPRecipes.map(r => r.facets.meal).filter(Boolean))];
const uniqueMethods = [...new Set(allMPRecipes.map(r => r.facets.method).filter(Boolean))];
const uniqueDiets = [...new Set(allMPRecipes.map(r => r.facets.diet).filter(Boolean))];
const uniqueGoals = [...new Set(allMPRecipes.map(r => r.facets.goal).filter(Boolean))];

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
}

const { title, description, canonicalUrl } = Astro.props;

// Facet groups for taxonomy nav
const facetGroups = [
  {
    title: 'By Method',
    titleHref: '/meal-prep/method/',
    items: ['Crockpot', 'Slow-Cooker', 'Instant-Pot', 'Air-Fryer', 'Microwave', 'Sheet-Pan', 'One-Pan', 'No-Cook', 'Freezer', 'Grill', 'Oven']
      .map(v => ({ label: v, href: `/meal-prep/method/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Persona',
    titleHref: '/meal-prep/persona/',
    items: [
      { label: 'Work / Office', href: '/meal-prep/persona/work/' },
      { label: 'College Student', href: '/meal-prep/persona/college/' },
      { label: 'Picky Eaters', href: '/meal-prep/persona/picky-eaters/' },
      { label: 'Kids', href: '/meal-prep/persona/kids/' },
      { label: 'Toddlers', href: '/meal-prep/persona/toddler/' },
      { label: 'Pregnancy', href: '/meal-prep/persona/pregnancy/' },
      { label: 'Postpartum', href: '/meal-prep/persona/postpartum/' },
      { label: 'Bariatric', href: '/meal-prep/persona/bariatric/' },
      { label: 'PCOS', href: '/meal-prep/persona/pcos/' },
      { label: 'Cholesterol', href: '/meal-prep/persona/cholesterol/' },
    ],
  },
  {
    title: 'By Goal',
    titleHref: '/meal-prep/goal/',
    items: ['Weight-Loss', 'Muscle-Gain', 'Healthy'].map(v => ({ label: v, href: `/meal-prep/goal/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Diet',
    titleHref: '/meal-prep/diet/',
    items: ['Vegan', 'Vegetarian', 'Low-Carb', 'Keto', 'Low-Calorie', 'Gluten-Free', 'Dairy-Free']
      .map(v => ({ label: v, href: `/meal-prep/diet/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Ingredient',
    titleHref: '/meal-prep/ingredient/',
    items: ['Chicken', 'Ground-Beef', 'Ground-Turkey', 'Salmon', 'Shrimp', 'Steak', 'Salad']
      .map(v => ({ label: v, href: `/meal-prep/ingredient/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Constraint',
    titleHref: '/meal-prep/constraint/',
    items: ['High-Fiber', 'Low-Sodium', 'Low-Fat', 'Budget', 'Cheap', 'Quick', 'Simple', 'For-The-Week', 'No-Microwave']
      .map(v => ({ label: v, href: `/meal-prep/constraint/${v.toLowerCase()}/` })),
  },
  {
    title: 'Popular Stores',
    titleHref: '/meal-prep/store/',
    items: [
      { label: "Trader Joe's", href: '/meal-prep/store/trader-joes/' },
      { label: 'Costco', href: '/meal-prep/store/costco/' },
      { label: 'Walmart', href: '/meal-prep/store/walmart/' },
      { label: 'Aldi', href: '/meal-prep/store/aldi/' },
      { label: 'Whole Foods', href: '/meal-prep/store/whole-foods/' },
      { label: 'Kroger', href: '/meal-prep/store/kroger/' },
      { label: 'Publix', href: '/meal-prep/store/publix/' },
      { label: 'Target', href: '/meal-prep/store/target/' },
      { label: "Sam's Club", href: '/meal-prep/store/sams-club/' },
      { label: 'H-E-B', href: '/meal-prep/store/heb/' },
    ],
  },
  {
    title: 'Popular Chains',
    titleHref: '/meal-prep/chain/',
    items: [
      { label: 'Chick-fil-A', href: '/meal-prep/chain/chick-fil-a/' },
      { label: "McDonald's", href: '/meal-prep/chain/mcdonalds/' },
      { label: 'Chipotle', href: '/meal-prep/chain/chipotle/' },
      { label: 'Panera', href: '/meal-prep/chain/panera/' },
      { label: 'Subway', href: '/meal-prep/chain/subway/' },
      { label: 'Taco Bell', href: '/meal-prep/chain/taco-bell/' },
      { label: "Wendy's", href: '/meal-prep/chain/wendys/' },
      { label: 'Sweetgreen', href: '/meal-prep/chain/sweetgreen/' },
    ],
  },
];

const exploreColumns = [
  {
    title: 'By Meal',
    titleHref: '/meal-prep/meal/',
    links: [
      { label: 'Breakfast Prep', href: '/meal-prep/meal/breakfast/' },
      { label: 'Lunch Prep', href: '/meal-prep/meal/lunch/' },
      { label: 'Dinner Prep', href: '/meal-prep/meal/dinner/' },
      { label: 'Snacks Prep', href: '/meal-prep/meal/snacks/' },
    ],
  },
  {
    title: 'By Method',
    titleHref: '/meal-prep/method/',
    links: [
      { label: 'Crockpot', href: '/meal-prep/method/crockpot/' },
      { label: 'Slow Cooker', href: '/meal-prep/method/slow-cooker/' },
      { label: 'Instant Pot', href: '/meal-prep/method/instant-pot/' },
      { label: 'Air Fryer', href: '/meal-prep/method/air-fryer/' },
      { label: 'Sheet Pan', href: '/meal-prep/method/sheet-pan/' },
      { label: 'Microwave', href: '/meal-prep/method/microwave/' },
      { label: 'No Cook', href: '/meal-prep/method/no-cook/' },
      { label: 'Freezer', href: '/meal-prep/method/freezer/' },
      { label: 'One Pan', href: '/meal-prep/method/one-pan/' },
      { label: 'Grill', href: '/meal-prep/method/grill/' },
      { label: 'Oven', href: '/meal-prep/method/oven/' },
    ],
  },
  {
    title: 'By Diet',
    titleHref: '/meal-prep/diet/',
    links: [
      { label: 'Vegan', href: '/meal-prep/diet/vegan/' },
      { label: 'Vegetarian', href: '/meal-prep/diet/vegetarian/' },
      { label: 'Low Carb', href: '/meal-prep/diet/low-carb/' },
      { label: 'Keto', href: '/meal-prep/diet/keto/' },
      { label: 'Low Calorie', href: '/meal-prep/diet/low-calorie/' },
      { label: 'Gluten Free', href: '/meal-prep/diet/gluten-free/' },
      { label: 'Dairy Free', href: '/meal-prep/diet/dairy-free/' },
    ],
  },
  {
    title: 'By Goal & Constraint',
    titleHref: '/meal-prep/goal/',
    links: [
      { label: 'Weight Loss', href: '/meal-prep/goal/weight-loss/' },
      { label: 'Muscle Gain', href: '/meal-prep/goal/muscle-gain/' },
      { label: 'Healthy', href: '/meal-prep/goal/healthy/' },
      { label: 'Budget', href: '/meal-prep/constraint/budget/' },
      { label: 'Quick', href: '/meal-prep/constraint/quick/' },
      { label: 'Simple', href: '/meal-prep/constraint/simple/' },
      { label: 'For The Week', href: '/meal-prep/constraint/for-the-week/' },
      { label: 'High Fiber', href: '/meal-prep/constraint/high-fiber/' },
      { label: 'No Microwave', href: '/meal-prep/constraint/no-microwave/' },
    ],
  },
];

const structuredData = JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'Meal Prep Hub',
  description: 'Browse all meal prep recipes, 5-day plans, and discover your perfect prep strategy with our interactive wizard.',
  url: 'https://mealprepideas.co/meal-prep/',
});

// i18n
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl} structuredData={structuredData}>
  <HeaderNav
    site="mealprepideas"
    activeLink="/meal-prep/"
    statusText="5-DAY SYSTEMS: READY"
  />

  <main class="flex-grow">
    <!-- ════════════════════════════════════════════════════════════════
         SECTION A: WIZARD TOOL — "BUILD YOUR PREP PROTOCOL"
         ════════════════════════════════════════════════════════════════ -->
    <section class="relative py-20 px-6 overflow-hidden" style="background: var(--bg-primary); border-bottom: 1px solid var(--border-default);"
             x-data="{
               goal: '',
               method: '',
               diet: '',
               meal: '',
               constraint: '',
               generatePlan() {
                 // Build URL from selections — navigate to best matching facet page
                 // Two-facet combos that exist for meal-prep: meal+constraint, diet+goal, persona+method
                 if (!this.goal && !this.method && !this.diet && !this.meal && !this.constraint) {
                   document.getElementById('recipe-browser')?.scrollIntoView({ behavior: 'smooth' });
                   return;
                 }
                 // Try two-facet combos first (matching indexed combos)
                 if (this.meal && this.constraint) {
                   window.location.href = '/meal-prep/meal/' + this.meal + '/constraint/' + this.constraint + '/';
                   return;
                 }
                 if (this.diet && this.goal) {
                   window.location.href = '/meal-prep/diet/' + this.diet + '/goal/' + this.goal + '/';
                   return;
                 }
                 // Fallback: canonical order single-facet (meal > method > diet > goal > constraint)
                 if (this.meal) { window.location.href = '/meal-prep/meal/' + this.meal + '/'; return; }
                 if (this.method) { window.location.href = '/meal-prep/method/' + this.method + '/'; return; }
                 if (this.diet) { window.location.href = '/meal-prep/diet/' + this.diet + '/'; return; }
                 if (this.goal) { window.location.href = '/meal-prep/goal/' + this.goal + '/'; return; }
                 if (this.constraint) { window.location.href = '/meal-prep/constraint/' + this.constraint + '/'; return; }
               },
               resetWizard() {
                 this.goal = '';
                 this.method = '';
                 this.diet = '';
                 this.meal = '';
                 this.constraint = '';
               }
             }">
      <!-- Grid background -->
      <div class="absolute inset-0 opacity-5 pointer-events-none">
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
          <defs><pattern id="wizGrid" width="24" height="24" patternUnits="userSpaceOnUse"><path d="M 24 0 L 0 0 0 24" fill="none" stroke="currentColor" stroke-width="0.5"/></pattern></defs>
          <rect width="100%" height="100%" fill="url(#wizGrid)" />
        </svg>
      </div>

      <div class="max-w-7xl mx-auto relative z-10">
        <!-- Header -->
        <div class="flex flex-col md:flex-row items-start md:items-end justify-between gap-8 mb-12">
          <div>
            <div class="inline-flex items-center gap-3 px-3 py-1 rounded-full mb-6"
                 style="background: var(--accent-glow); border: 1px solid var(--border-hover);">
              <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75" style="background-color: var(--accent-primary);"></span>
                <span class="relative inline-flex rounded-full h-2 w-2" style="background-color: var(--accent-primary);"></span>
              </span>
              <span class="text-[10px] font-black tracking-widest uppercase" style="color: var(--accent-primary);">{t('hub.interactiveWizard')}</span>
            </div>
            <h1 class="text-5xl md:text-7xl font-black tracking-tighter leading-[0.85] mb-4" style="color: var(--text-primary);">
              BUILD YOUR<br/>PREP PROTOCOL
            </h1>
            <p class="max-w-lg text-lg font-medium" style="color: var(--text-secondary);">
              Select your constraints below and we'll generate the perfect meal prep strategy. Pick as many or as few as you want.
            </p>
          </div>
          <div class="text-right">
            <span class="text-[48px] font-black tabular-nums tracking-tighter block leading-none" style="color: var(--text-primary);">{mpRecipeCount}</span>
            <span class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--text-secondary);">{t('hub.recipesAvailable')}</span>
          </div>
        </div>

        <!-- Wizard Steps -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
          <!-- 01. Goal -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.goal')}</label>
            <div class="space-y-2">
              <template x-for="g in [{v:'weight-loss',l:'Weight Loss'},{v:'muscle-gain',l:'Muscle Gain'},{v:'healthy',l:'Healthy'}]">
                <button x-on:click="goal = goal === g.v ? '' : g.v"
                        x-bind:style="goal === g.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="g.l"></button>
              </template>
            </div>
          </div>

          <!-- 02. Method -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.method')}</label>
            <div class="space-y-2">
              <template x-for="m in [{v:'crockpot',l:'Crockpot'},{v:'air-fryer',l:'Air Fryer'},{v:'microwave',l:'Microwave'},{v:'no-cook',l:'No-Cook'},{v:'freezer',l:'Freezer'},{v:'instant-pot',l:'Instant Pot'}]">
                <button x-on:click="method = method === m.v ? '' : m.v"
                        x-bind:style="method === m.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="m.l"></button>
              </template>
            </div>
          </div>

          <!-- 03. Diet -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.diet')}</label>
            <div class="space-y-2">
              <template x-for="d in [{v:'vegan',l:'Vegan'},{v:'keto',l:'Keto'},{v:'low-carb',l:'Low-Carb'},{v:'gluten-free',l:'Gluten-Free'},{v:'dairy-free',l:'Dairy-Free'},{v:'vegetarian',l:'Vegetarian'}]">
                <button x-on:click="diet = diet === d.v ? '' : d.v"
                        x-bind:style="diet === d.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="d.l"></button>
              </template>
            </div>
          </div>

          <!-- 04. Meal -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.meal')}</label>
            <div class="space-y-2">
              <template x-for="m in [{v:'breakfast',l:'Breakfast'},{v:'lunch',l:'Lunch'},{v:'dinner',l:'Dinner'},{v:'snacks',l:'Snacks'}]">
                <button x-on:click="meal = meal === m.v ? '' : m.v"
                        x-bind:style="meal === m.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="m.l"></button>
              </template>
            </div>
          </div>

          <!-- 05. Constraint -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.constraint')}</label>
            <div class="space-y-2">
              <template x-for="c in [{v:'budget',l:'Budget'},{v:'quick',l:'Quick'},{v:'high-fiber',l:'High-Fiber'},{v:'no-microwave',l:'No-Microwave'},{v:'simple',l:'Simple'}]">
                <button x-on:click="constraint = constraint === c.v ? '' : c.v"
                        x-bind:style="constraint === c.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="c.l"></button>
              </template>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4">
          <button x-on:click="generatePlan()"
                  class="theme-btn-cta px-10 py-5 rounded-xl font-black uppercase text-sm tracking-widest transition-transform hover:scale-[1.02] flex items-center justify-center gap-3 cursor-pointer">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            {t('hub.generateProtocol')}
          </button>
          <button x-on:click="resetWizard()"
                  class="px-8 py-5 rounded-xl font-black uppercase text-xs tracking-widest transition-all cursor-pointer"
                  style="border: 1px solid var(--border-default); color: var(--text-secondary);">
            {t('hub.resetAll')}
          </button>
        </div>
      </div>
    </section>


    <!-- ════════════════════════════════════════════════════════════════
         SECTION B: FILTERABLE RECIPE & PLAN BROWSER
         ════════════════════════════════════════════════════════════════ -->
    <section id="recipe-browser" class="py-20 px-6"
             style="background: var(--bg-secondary); border-bottom: 1px solid var(--border-default);"
             x-data={`{
               filter: 'all',
               allRecipes: ${alpineRecipeData},
               allPlans: ${alpinePlanData},
               get filteredRecipes() {
                 if (this.filter === 'all') return this.allRecipes;
                 return this.allRecipes.filter(r => {
                   return r.meal === this.filter || r.method === this.filter || r.diet === this.filter || r.goal === this.filter;
                 });
               }
             }`}>
      <div class="max-w-7xl mx-auto">
        <!-- Section Header -->
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 mb-10">
          <div>
            <div class="flex items-center gap-4 mb-3">
              <div class="h-[2px] w-12" style="background-color: var(--accent-primary);"></div>
              <span class="text-[10px] font-black tracking-[0.5em] uppercase" style="color: var(--accent-primary);">{t('hub.browseFilter')}</span>
            </div>
            <h2 class="text-4xl font-black tracking-tighter" style="color: var(--text-primary);">{t('hub.allRecipes')}</h2>
          </div>
          <div class="text-sm font-bold" style="color: var(--text-secondary);">
            Showing <span class="font-black" style="color: var(--accent-primary);" x-text="filteredRecipes.length"></span> {t('hub.recipesLc')}
          </div>
        </div>

        <!-- Filter Pills -->
        <div class="flex flex-wrap gap-2 mb-10">
          <button x-on:click="filter = 'all'"
                  x-bind:style="filter === 'all' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                  class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">All</button>
          {/* Meal type filters */}
          {uniqueMeals.map(m => (
            <button x-on:click={`filter = filter === '${m}' ? 'all' : '${m}'`}
                    x-bind:style={`filter === '${m}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{m}</button>
          ))}
          {/* Method filters */}
          {uniqueMethods.map(m => (
            <button x-on:click={`filter = filter === '${m}' ? 'all' : '${m}'`}
                    x-bind:style={`filter === '${m}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{m.replace(/-/g, ' ')}</button>
          ))}
          {/* Diet filters */}
          {uniqueDiets.map(d => (
            <button x-on:click={`filter = filter === '${d}' ? 'all' : '${d}'`}
                    x-bind:style={`filter === '${d}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{d.replace(/-/g, ' ')}</button>
          ))}
          {/* Goal filters */}
          {uniqueGoals.map(g => (
            <button x-on:click={`filter = filter === '${g}' ? 'all' : '${g}'`}
                    x-bind:style={`filter === '${g}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{g.replace(/-/g, ' ')}</button>
          ))}
        </div>

        <!-- Recipe Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <template x-for="r in filteredRecipes" x-bind:key="r.slug">
            <a x-bind:href="'/meal-prep/recipes/' + r.slug + '/'"
               class="group rounded-2xl overflow-hidden transition-all hover:shadow-lg hover:-translate-y-1"
               style="border: 1px solid var(--border-default); background: var(--bg-primary);">
              <div class="aspect-video overflow-hidden relative">
                <img x-bind:src="'/images/recipes/' + r.slug + '.jpg'"
                     x-on:error="$el.src='/images/placeholder.svg'"
                     x-bind:alt="r.imageAlt"
                     class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                     width="400" height="225" loading="lazy" />
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                <div class="absolute bottom-3 left-3 flex gap-2">
                  <span class="px-2 py-1 rounded text-[9px] font-black uppercase"
                        style="background-color: var(--accent-primary); color: var(--text-inverse);"
                        x-text="r.protein + 'g protein'"></span>
                  <span class="px-2 py-1 rounded text-[9px] font-black uppercase"
                        style="background: rgba(0,0,0,0.6); color: white;"
                        x-text="r.meal || 'prep'"
                        x-show="r.meal"></span>
                </div>
              </div>
              <div class="p-4">
                <h3 class="font-black text-sm mb-2 leading-tight group-hover:opacity-80 transition-opacity" style="color: var(--text-primary);" x-text="r.title"></h3>
                <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                  <span x-text="r.calories + ' cal'"></span>
                  <span>·</span>
                  <span x-text="r.prepTime + 'm total'"></span>
                  <span>·</span>
                  <span x-text="r.servings + ' servings'"></span>
                </div>
              </div>
            </a>
          </template>
        </div>

        <!-- Empty State -->
        <div x-show="filteredRecipes.length === 0" class="text-center py-16 rounded-2xl" style="background: var(--bg-primary); border: 1px solid var(--border-default);">
          <p class="text-lg font-bold mb-2" style="color: var(--text-secondary);">{t('hub.noRecipesMatch')}</p>
          <button x-on:click="filter = 'all'" class="text-xs font-black uppercase tracking-widest cursor-pointer" style="color: var(--accent-primary);">{t('hub.showAllRecipes')}</button>
        </div>

        <!-- PLANS SECTION -->
        <div class="mt-20">
          <div class="flex items-center gap-4 mb-10">
            <div class="h-[2px] w-12" style="background-color: var(--accent-primary);"></div>
            <span class="text-[10px] font-black tracking-[0.5em] uppercase" style="color: var(--accent-primary);">{t('hub.fiveDayPlans')}</span>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="p in allPlans" x-bind:key="p.slug">
              <a x-bind:href="'/meal-prep/plans/' + p.slug + '/'"
                 class="group rounded-2xl p-8 transition-all hover:shadow-lg hover:-translate-y-1 flex flex-col justify-between"
                 style="border: 1px solid var(--border-default); background: var(--bg-primary);">
                <div>
                  <div class="flex items-center gap-2 mb-4">
                    <span class="px-2 py-1 rounded text-[9px] font-black uppercase"
                          style="background: var(--accent-glow); color: var(--accent-primary); border: 1px solid var(--accent-primary);">5-Day Plan</span>
                  </div>
                  <h3 class="font-black text-xl tracking-tight mb-3 leading-tight group-hover:opacity-80 transition-opacity" style="color: var(--text-primary);" x-text="p.title"></h3>
                  <p class="text-sm font-medium mb-6 line-clamp-2" style="color: var(--text-secondary);" x-text="p.description"></p>
                </div>
                <div class="grid grid-cols-3 gap-3">
                  <div class="text-center p-3 rounded-xl" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                    <span class="block text-lg font-black tabular-nums" style="color: var(--text-primary);" x-text="p.totalMeals"></span>
                    <span class="text-[8px] font-bold uppercase" style="color: var(--text-tertiary);">{t('hub.meals')}</span>
                  </div>
                  <div class="text-center p-3 rounded-xl" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                    <span class="block text-lg font-black tabular-nums" style="color: var(--accent-primary);" x-text="p.dailyProtein + 'g'"></span>
                    <span class="text-[8px] font-bold uppercase" style="color: var(--text-tertiary);">{t('hub.proteinDay')}</span>
                  </div>
                  <div class="text-center p-3 rounded-xl" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                    <span class="block text-lg font-black tabular-nums" style="color: var(--text-primary);" x-text="p.groceryBudget"></span>
                    <span class="text-[8px] font-bold uppercase" style="color: var(--text-tertiary);">{t('hub.budget')}</span>
                  </div>
                </div>
              </a>
            </template>
          </div>
        </div>
      </div>
    </section>


    <!-- ════════════════════════════════════════════════════════════════
         SECTION C: TAXONOMY NAVIGATION (preserved from Phase 8)
         ════════════════════════════════════════════════════════════════ -->
    <FacetNav layout="columns" sectionTitle="Universal Taxonomy" badge="54 Active Dimensions" groups={facetGroups} />

    <!-- DATA STREAM -->
    <section class="py-12 relative" style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-default);">
      <div class="data-stream overflow-hidden whitespace-nowrap flex py-2" style="border-top: 1px solid var(--accent-glow); border-bottom: 1px solid var(--accent-glow);">
        <div class="flex animate-marquee gap-8 items-center">
          {[1,2,3,4,5].map(() => (
            <div class="flex gap-8 items-center">
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--accent-primary);">MEAL PREP HUB</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--text-tertiary);">{mpRecipeCount} RECIPES</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--accent-primary);">{allMPPlans.length} PLANS</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--text-tertiary);">AVG {avgProtein}g PROTEIN</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
            </div>
          ))}
        </div>
      </div>
    </section>
  </main>

  <FooterNav site="mealprepideas" />
</BaseLayout>
