---
/**
 * MealPrepHub — Meal Prep Authority Hub (T1)
 * Theme-aware: uses CSS custom properties
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import FacetNav from './FacetNav.astro';
import ExploreByBlock from './ExploreByBlock.astro';
import { recipes } from '../data/content/recipes';
import { plans } from '../data/content/plans';
import {
  getAverageProtein,
  getAverageMealsPerPlan,
  getAveragePlanBudget,
  getMealPrepRecipeCount,
} from '../utils/stats';

const allMPRecipes = recipes.filter(r => r.hub === 'meal-prep');
const mealPrepRecipes = allMPRecipes.slice(0, 8);
const fallbackImage = '/images/placeholder.svg';

// Serialize recipe data for Alpine.js
const alpineRecipeData = JSON.stringify(
  allMPRecipes.map(r => ({
    slug: r.slug,
    title: r.title,
    protein: r.protein,
    calories: r.calories,
    imageAlt: r.imageAlt || r.title,
    prepTime: r.prepTime + r.cookTime,
    servings: r.servings,
    facets: {
      goal: r.facets.goal || null,
      diet: r.facets.diet || null,
      method: r.facets.method || null,
    },
  }))
);

// Plan slugs for linking from decision engine
const planMap = JSON.stringify({
  'Weight Loss': plans.find(p => p.hub === 'meal-prep' && p.facets.constraint === 'budget')?.slug || 'beginner-meal-prep-5-day',
  'Muscle Gain': plans.find(p => p.hub === 'meal-prep' && p.facets.persona === 'work')?.slug || 'beginner-meal-prep-5-day',
  'Cheap & Quick': plans.find(p => p.hub === 'meal-prep' && p.facets.constraint === 'quick')?.slug || 'quick-30-min-prep-plan',
});

// Dynamic stats
const avgProtein = getAverageProtein();
const avgMeals = getAverageMealsPerPlan();
const avgBudget = getAveragePlanBudget();
const mpRecipeCount = getMealPrepRecipeCount();

// Get the first meal-prep plan for linking
const firstMealPrepPlan = plans.find(p => p.hub === 'meal-prep');

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
}

const { title, description, canonicalUrl } = Astro.props;

const facetGroups = [
  {
    title: 'By Method',
    items: ['Crockpot', 'Slow-Cooker', 'Instant-Pot', 'Air-Fryer', 'Microwave', 'Sheet-Pan', 'One-Pan', 'No-Cook', 'Freezer', 'Grill', 'Oven']
      .map(v => ({ label: v, href: `/meal-prep/method/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Persona',
    items: [
      { label: 'Work / Office', href: '/meal-prep/persona/work/' },
      { label: 'College Student', href: '/meal-prep/persona/college/' },
      { label: 'Picky Eaters', href: '/meal-prep/persona/picky-eaters/' },
      { label: 'Kids', href: '/meal-prep/persona/kids/' },
      { label: 'Toddlers', href: '/meal-prep/persona/toddler/' },
      { label: 'Pregnancy', href: '/meal-prep/persona/pregnancy/' },
      { label: 'Postpartum', href: '/meal-prep/persona/postpartum/' },
      { label: 'Bariatric', href: '/meal-prep/persona/bariatric/' },
      { label: 'PCOS', href: '/meal-prep/persona/pcos/' },
      { label: 'Cholesterol', href: '/meal-prep/persona/cholesterol/' },
    ],
  },
  {
    title: 'By Goal',
    items: ['Weight-Loss', 'Muscle-Gain', 'Healthy'].map(v => ({ label: v, href: `/meal-prep/goal/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Diet',
    items: ['Vegan', 'Vegetarian', 'Low-Carb', 'Keto', 'Low-Calorie', 'Gluten-Free', 'Dairy-Free']
      .map(v => ({ label: v, href: `/meal-prep/diet/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Ingredient',
    items: ['Chicken', 'Ground-Beef', 'Ground-Turkey', 'Salmon', 'Shrimp', 'Steak', 'Salad']
      .map(v => ({ label: v, href: `/meal-prep/ingredient/${v.toLowerCase()}/` })),
  },
  {
    title: 'By Constraint',
    items: ['High-Fiber', 'Low-Sodium', 'Low-Fat', 'Budget', 'Cheap', 'Quick', 'Simple', 'For-The-Week', 'No-Microwave']
      .map(v => ({ label: v, href: `/meal-prep/constraint/${v.toLowerCase()}/` })),
  },
  {
    title: 'Popular Stores',
    items: [
      { label: "Trader Joe's", href: '/meal-prep/store/trader-joes/' },
      { label: 'Costco', href: '/meal-prep/store/costco/' },
      { label: 'Walmart', href: '/meal-prep/store/walmart/' },
      { label: 'Aldi', href: '/meal-prep/store/aldi/' },
      { label: 'Whole Foods', href: '/meal-prep/store/whole-foods/' },
      { label: 'Kroger', href: '/meal-prep/store/kroger/' },
      { label: 'Publix', href: '/meal-prep/store/publix/' },
      { label: 'Target', href: '/meal-prep/store/target/' },
      { label: "Sam's Club", href: '/meal-prep/store/sams-club/' },
      { label: 'H-E-B', href: '/meal-prep/store/heb/' },
    ],
  },
  {
    title: 'Popular Chains',
    items: [
      { label: 'Chick-fil-A', href: '/meal-prep/chain/chick-fil-a/' },
      { label: "McDonald's", href: '/meal-prep/chain/mcdonalds/' },
      { label: 'Chipotle', href: '/meal-prep/chain/chipotle/' },
      { label: 'Panera', href: '/meal-prep/chain/panera/' },
      { label: 'Subway', href: '/meal-prep/chain/subway/' },
      { label: 'Taco Bell', href: '/meal-prep/chain/taco-bell/' },
      { label: "Wendy's", href: '/meal-prep/chain/wendys/' },
      { label: 'Sweetgreen', href: '/meal-prep/chain/sweetgreen/' },
    ],
  },
];

// ExploreByBlock columns for additional internal links on the hub
const exploreColumns = [
  {
    title: 'By Meal',
    links: [
      { label: 'Breakfast Prep', href: '/meal-prep/meal/breakfast/' },
      { label: 'Lunch Prep', href: '/meal-prep/meal/lunch/' },
      { label: 'Dinner Prep', href: '/meal-prep/meal/dinner/' },
      { label: 'Snacks Prep', href: '/meal-prep/meal/snacks/' },
    ],
  },
  {
    title: 'By Method',
    links: [
      { label: 'Crockpot', href: '/meal-prep/method/crockpot/' },
      { label: 'Slow Cooker', href: '/meal-prep/method/slow-cooker/' },
      { label: 'Instant Pot', href: '/meal-prep/method/instant-pot/' },
      { label: 'Air Fryer', href: '/meal-prep/method/air-fryer/' },
      { label: 'Sheet Pan', href: '/meal-prep/method/sheet-pan/' },
      { label: 'Microwave', href: '/meal-prep/method/microwave/' },
      { label: 'No Cook', href: '/meal-prep/method/no-cook/' },
      { label: 'Freezer', href: '/meal-prep/method/freezer/' },
      { label: 'One Pan', href: '/meal-prep/method/one-pan/' },
      { label: 'Grill', href: '/meal-prep/method/grill/' },
      { label: 'Oven', href: '/meal-prep/method/oven/' },
    ],
  },
  {
    title: 'By Diet',
    links: [
      { label: 'Vegan', href: '/meal-prep/diet/vegan/' },
      { label: 'Vegetarian', href: '/meal-prep/diet/vegetarian/' },
      { label: 'Low Carb', href: '/meal-prep/diet/low-carb/' },
      { label: 'Keto', href: '/meal-prep/diet/keto/' },
      { label: 'Low Calorie', href: '/meal-prep/diet/low-calorie/' },
      { label: 'Gluten Free', href: '/meal-prep/diet/gluten-free/' },
      { label: 'Dairy Free', href: '/meal-prep/diet/dairy-free/' },
    ],
  },
  {
    title: 'By Goal & Constraint',
    links: [
      { label: 'Weight Loss', href: '/meal-prep/goal/weight-loss/' },
      { label: 'Muscle Gain', href: '/meal-prep/goal/muscle-gain/' },
      { label: 'Healthy', href: '/meal-prep/goal/healthy/' },
      { label: 'Budget', href: '/meal-prep/constraint/budget/' },
      { label: 'Quick', href: '/meal-prep/constraint/quick/' },
      { label: 'Simple', href: '/meal-prep/constraint/simple/' },
      { label: 'For The Week', href: '/meal-prep/constraint/for-the-week/' },
      { label: 'High Fiber', href: '/meal-prep/constraint/high-fiber/' },
      { label: 'No Microwave', href: '/meal-prep/constraint/no-microwave/' },
    ],
  },
];

const structuredData = JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  name: 'Meal Prep Hub Authority Clusters',
  description: 'Comprehensive guides for meal planning, batch cooking, and food storage logistics.',
  itemListElement: [
    { '@type': 'ListItem', position: 1, url: 'https://mealprepideas.co/meal-prep/method/crockpot/', name: 'Crockpot Meal Prep' },
    { '@type': 'ListItem', position: 2, url: 'https://mealprepideas.co/meal-prep/persona/postpartum/', name: 'Postpartum Freezer Prep' },
  ],
});
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl} structuredData={structuredData}>
  <HeaderNav
    site="mealprepideas"
    activeLink="/meal-prep/"
    statusText="5-DAY SYSTEMS: READY"
  />

  <main class="flex-grow" x-data={`{
    decisionGoal: 'Weight Loss',
    decisionMethod: 'Batch Cooking',
    showResults: false,
    allRecipes: ${alpineRecipeData},
    planMap: ${planMap},
    get filteredRecipes() {
      const goalMap = { 'Weight Loss': 'weight-loss', 'Muscle Gain': 'muscle-gain', 'Cheap & Quick': null };
      const methodMap = { 'Batch Cooking': null, 'Freezer Dump': 'freezer', 'Slow Cooker': ['crockpot', 'slow-cooker'], 'No-Cook Cold': 'no-cook' };
      return this.allRecipes.filter(r => {
        const gv = goalMap[this.decisionGoal];
        if (gv && r.facets.goal && r.facets.goal !== gv) return false;
        const mv = methodMap[this.decisionMethod];
        if (mv) {
          if (Array.isArray(mv)) { if (r.facets.method && !mv.includes(r.facets.method)) return false; }
          else { if (r.facets.method && r.facets.method !== mv) return false; }
        }
        return true;
      });
    },
    get resultsCount() { return this.filteredRecipes.length; },
    getFullPlan() {
      const slug = this.planMap[this.decisionGoal] || 'beginner-meal-prep-5-day';
      window.location.href = '/meal-prep/plans/' + slug + '/';
    },
    viewDecisionResults() {
      this.showResults = true;
      this.$nextTick(() => {
        const el = document.getElementById('mp-engine-results');
        if (el) el.scrollIntoView({ behavior: 'smooth' });
      });
    }
  }`}>
    <!-- T1 HERO: LOGISTICS COMMAND CENTER -->
    <section class="relative min-h-[80vh] flex flex-col justify-center px-6 overflow-hidden"
             style="border-bottom: 1px solid var(--border-default); background: var(--bg-primary);">
      <div class="absolute inset-0 opacity-10 pointer-events-none">
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
          <defs><pattern id="smallGrid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="currentColor" stroke-width="0.5"/></pattern></defs>
          <rect width="100%" height="100%" fill="url(#smallGrid)" />
        </svg>
      </div>
      <div class="max-w-7xl mx-auto w-full relative z-10 grid md:grid-cols-2 gap-12 items-center">
        <div>
          <div class="inline-flex items-center gap-3 px-3 py-1 rounded-full mb-6"
               style="background: var(--accent-glow); border: 1px solid var(--border-hover);">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75" style="background-color: var(--accent-primary);"></span>
              <span class="relative inline-flex rounded-full h-2 w-2" style="background-color: var(--accent-primary);"></span>
            </span>
            <span class="text-[10px] font-black tracking-widest uppercase" style="color: var(--accent-primary);">System Authority: Meal-Prep</span>
          </div>
          <h1 class="text-7xl md:text-[120px] font-black tracking-tighter leading-[0.85] mb-8 italic" style="color: var(--text-primary);">
            BATCH.<br/>STORE.<br/><span class="text-stroke">EXECUTE.</span>
          </h1>
          <p class="max-w-md font-medium text-lg leading-relaxed mb-10" style="color: var(--text-secondary);">
            The definitive framework for high-volume food logistics. From 90-minute Sunday sprints to postpartum freezer stashes.
          </p>
          <div class="flex flex-wrap gap-4">
            <a href="#decision" class="theme-btn-primary px-8 py-4 rounded-xl font-black uppercase text-xs tracking-widest hover:scale-105 transition-transform">Start Planning</a>
            <a href="#clusters" class="px-8 py-4 rounded-xl font-black uppercase text-xs tracking-widest transition-all"
               style="border: 1px solid var(--border-default); color: var(--text-primary);">Browse Clusters</a>
          </div>
        </div>
        <div class="relative hidden md:block group">
          <div class="scanner-line"></div>
          <div class="relative aspect-square rounded-3xl overflow-hidden shadow-2xl"
               style="border: 1px solid var(--border-default);">
            <img src="/images/hero-meal-prep.jpg" onerror="this.onerror=null;this.src='/images/placeholder.svg'" class="w-full h-full object-cover grayscale opacity-50 group-hover:grayscale-0 group-hover:opacity-100 transition-all duration-1000" alt="Organized meal prep containers with colorful food, birds eye view" width="1000" height="1000" />
            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
            <div class="absolute bottom-8 left-8 right-8 backdrop-blur-md p-6 rounded-2xl"
                 style="background: var(--bg-nav); border: 1px solid var(--border-default);">
              <div class="flex justify-between items-end">
                <div>
                  <span class="text-[10px] font-black uppercase tracking-widest mb-1 block" style="color: var(--accent-primary);">Featured Strategy</span>
                  <h3 class="text-xl font-black tracking-tight" style="color: var(--text-primary);">Sunday Logistics: 15 Meals</h3>
                </div>
                <div class="text-right">
                  <span class="text-2xl font-black tabular-nums tracking-tighter" style="color: var(--text-primary);">90m</span>
                  <span class="text-[8px] font-bold uppercase block" style="color: var(--text-tertiary);">EXECUTION TIME</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- DECISION ENGINE -->
    <section id="decision" class="py-24 px-6" style="border-bottom: 1px solid var(--border-default); background: var(--bg-tertiary);">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row items-baseline justify-between mb-16 gap-4">
          <h2 class="text-4xl font-black tracking-tighter uppercase italic" style="color: var(--text-primary);">Decision Engine</h2>
          <p class="font-bold text-xs uppercase tracking-widest" style="color: var(--text-tertiary);">Select Constraints to Fetch Optimized Path</p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
          <div class="hyper-border p-8 rounded-3xl" x-bind:style="decisionGoal === 'Weight Loss' ? 'border-color: var(--accent-primary)' : ''">
            <span class="text-[10px] font-black uppercase tracking-widest mb-10 block" style="color: var(--text-tertiary);">01 / Objective</span>
            <div class="space-y-4">
              <template x-for="goal in ['Weight Loss', 'Muscle Gain', 'Cheap & Quick']">
                <button x-on:click="decisionGoal = goal"
                        x-bind:style="decisionGoal === goal ? 'color: var(--accent-primary)' : 'color: var(--text-tertiary)'"
                        class="flex items-center justify-between w-full text-left font-black tracking-tight text-xl group transition-all">
                  <span x-text="goal"></span>
                  <div class="w-4 h-4 rounded-full flex items-center justify-center" style="border: 1px solid var(--border-default);">
                    <div class="w-2 h-2 rounded-full transition-opacity" style="background-color: var(--accent-primary);" x-bind:class="decisionGoal === goal ? 'opacity-100' : 'opacity-0'"></div>
                  </div>
                </button>
              </template>
            </div>
          </div>
          <div class="hyper-border p-8 rounded-3xl">
            <span class="text-[10px] font-black uppercase tracking-widest mb-10 block" style="color: var(--text-tertiary);">02 / Method</span>
            <select x-model="decisionMethod" class="w-full p-4 rounded-xl font-bold tracking-tight text-xl outline-none appearance-none"
                    style="background: var(--bg-tertiary); border: 1px solid var(--border-default); color: var(--text-primary);">
              <option>Batch Cooking</option>
              <option>Freezer Dump</option>
              <option>Slow Cooker</option>
              <option>No-Cook Cold</option>
            </select>
          </div>
          <div class="lg:col-span-2 rounded-3xl p-8 flex flex-col justify-between relative overflow-hidden group"
               style="background-color: var(--accent-primary); color: var(--text-inverse);">
            <div class="relative z-10">
              <div class="flex justify-between items-start mb-8">
                <span class="text-[10px] font-black uppercase tracking-widest px-2 py-1 rounded"
                      style="background: var(--text-primary); color: var(--bg-primary);">Recommended System</span>
                <span class="text-xs font-black italic">INDEX-V4.2</span>
              </div>
              <h4 class="text-4xl font-black tracking-tighter leading-none mb-4" x-text="'The ' + decisionGoal + ' ' + decisionMethod + ' Protocol'"></h4>
              <p class="font-bold text-sm max-w-xs opacity-70">Custom-generated execution plan. <span x-text="resultsCount"></span> matching recipes found.</p>
            </div>
            <div class="mt-12 flex gap-4 relative z-10">
              <button x-on:click="getFullPlan()" class="flex-1 py-4 rounded-xl font-black uppercase text-xs tracking-widest hover:scale-[1.02] transition-transform"
                      style="background: var(--text-primary); color: var(--bg-primary);">Get The Full Plan</button>
              <button x-on:click="viewDecisionResults()" class="flex-1 py-4 rounded-xl font-black uppercase text-xs tracking-widest hover:scale-[1.02] transition-transform"
                      style="border: 2px solid var(--text-inverse);">View Recipes</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- INLINE DECISION RESULTS -->
    <section id="mp-engine-results" x-show="showResults" x-cloak class="py-16 px-6 max-w-7xl mx-auto" x-transition>
      <div class="flex items-center gap-4 mb-8">
        <div class="h-[2px] w-16" style="background-color: var(--accent-primary);"></div>
        <h3 class="text-xs font-black tracking-[0.5em] uppercase" style="color: var(--text-tertiary);">
          Matching Recipes (<span x-text="filteredRecipes.length"></span>)
        </h3>
      </div>
      <div x-show="filteredRecipes.length === 0" class="text-center py-12">
        <p class="text-lg font-bold" style="color: var(--text-secondary);">No recipes match your current selections. Try adjusting your goal or method.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <template x-for="r in filteredRecipes" x-bind:key="r.slug">
          <a x-bind:href="'/meal-prep/recipes/' + r.slug + '/'" class="group rounded-2xl overflow-hidden border transition-all hover:shadow-lg hover:-translate-y-1" style="border-color: var(--border-default); background: var(--bg-secondary);">
            <div class="aspect-video overflow-hidden relative">
              <img
                x-bind:src="'/images/recipes/' + r.slug + '.jpg'"
                x-on:error="$el.src='/images/placeholder.svg'"
                x-bind:alt="r.imageAlt"
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                width="400" height="225" loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
              <div class="absolute bottom-3 left-3">
                <span class="px-2 py-1 rounded text-[9px] font-black uppercase" style="background-color: var(--accent-primary); color: var(--text-inverse);" x-text="r.protein + 'g protein'"></span>
              </div>
            </div>
            <div class="p-4">
              <h3 class="font-black text-sm mb-2 leading-tight group-hover:opacity-80 transition-opacity" x-text="r.title"></h3>
              <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                <span x-text="r.calories + ' cal'"></span>
                <span>·</span>
                <span x-text="r.prepTime + 'm total'"></span>
                <span>·</span>
                <span x-text="r.servings + ' servings'"></span>
              </div>
            </div>
          </a>
        </template>
      </div>
      <div class="text-center mt-8">
        <button x-on:click="showResults = false" class="text-xs font-black uppercase tracking-widest" style="color: var(--accent-primary);">
          ← Back to Engine
        </button>
      </div>
    </section>

    <!-- TOP CLUSTERS -->
    <section id="clusters" class="py-24 px-6 max-w-7xl mx-auto">
      <div class="flex items-center gap-4 mb-16">
        <div class="h-[2px] w-24" style="background-color: var(--accent-primary);"></div>
        <h2 class="text-xs font-black tracking-[0.5em] uppercase" style="color: var(--text-tertiary);">Core Authority Pillars</h2>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <div class="md:col-span-7 bento-card p-10 flex flex-col justify-between group overflow-hidden relative">
          <div class="relative z-10">
            <span class="font-black text-[10px] tracking-widest uppercase mb-4 block" style="color: var(--accent-primary);">System 01</span>
            <h3 class="text-5xl font-black tracking-tighter mb-6 leading-none italic" style="color: var(--text-primary);">LOGISTICS<br/>BY METHOD</h3>
            <p class="max-w-sm font-medium mb-8" style="color: var(--text-secondary);">Specialized batching protocols for Crockpot, Air-Fryer, and Freezer-first strategies.</p>
            <div class="flex flex-wrap gap-2">
              {['Instant Pot', 'Slow-Cooker', 'No-Cook'].map(tag => (
                <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest transition-all"
                      style="background: var(--bg-tertiary); border: 1px solid var(--border-default); color: var(--text-secondary);">{tag}</span>
              ))}
            </div>
          </div>
        </div>
        <div class="md:col-span-5 bento-card p-10 flex flex-col justify-between"
             style="background: var(--bg-tertiary);">
          <div>
            <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-8"
                 style="background: var(--text-primary); color: var(--accent-primary);">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            </div>
            <h3 class="text-4xl font-black tracking-tighter mb-4 leading-none uppercase" style="color: var(--text-primary);">PERSONA<br/>FLOWS</h3>
            <p class="font-bold mb-6" style="color: var(--text-secondary);">Optimized meal systems for postpartum recovery, student life, and picky toddlers.</p>
          </div>
          <a href="/meal-prep/persona/work/" class="group flex items-center justify-between text-xs font-black uppercase tracking-widest pt-6"
             style="border-top: 1px solid var(--border-default); color: var(--text-primary);">
            Explore Personas
            <svg class="w-5 h-5 group-hover:translate-x-2 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
          </a>
        </div>
        <div class="md:col-span-12 bento-card p-8 md:p-12 flex flex-col md:flex-row items-center gap-12 group">
          <div class="flex-1">
            <h3 class="text-5xl md:text-7xl font-black tracking-tighter italic uppercase mb-6 leading-[0.85]" style="color: var(--text-primary);">The Weekly<br/>Blueprint</h3>
            <p class="font-bold mb-8 max-w-lg italic uppercase text-sm tracking-widest" style="color: var(--text-tertiary);">A standardized 5-day cycle: Sunday Prep to Friday Night Survival.</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
              {[
                { value: String(avgMeals), label: 'Meals / Plan' },
                { value: avgBudget, label: 'Budget Avg' },
                { value: String(mpRecipeCount), label: 'Recipes' },
                { value: `${avgProtein}g`, label: 'Protein Avg' },
              ].map(stat => (
                <div class="p-4 rounded-xl" style="border: 1px solid var(--border-default);">
                  <span class="text-2xl font-black tabular-nums tracking-tighter block" style="color: var(--accent-primary);">{stat.value}</span>
                  <span class="text-[8px] font-black uppercase tracking-widest" style="color: var(--text-tertiary);">{stat.label}</span>
                </div>
              ))}
            </div>
            <a href={firstMealPrepPlan ? `/meal-prep/plans/${firstMealPrepPlan.slug}/` : '/meal-prep/'} class="theme-btn-primary w-full py-5 rounded-2xl font-black uppercase text-xs tracking-widest hover:-translate-y-1 transition-transform block text-center">Download Current Protocol</a>
          </div>
          <div class="w-full md:w-1/3 aspect-[4/5] rounded-3xl overflow-hidden relative"
               style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
            <img src="/images/hero-meal-prep.jpg" onerror="this.onerror=null;this.src='/images/placeholder.svg'" class="w-full h-full object-cover opacity-60 mix-blend-luminosity hover:opacity-100 hover:mix-blend-normal transition-all duration-1000" alt="Meal prep containers with organized food portions" />
            <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- FEATURED RECIPES -->
    <section class="py-24 px-6 max-w-7xl mx-auto">
      <div class="flex items-center gap-4 mb-12">
        <div class="h-[2px] w-24" style="background-color: var(--accent-primary);"></div>
        <h2 class="text-xs font-black tracking-[0.5em] uppercase" style="color: var(--text-tertiary);">Featured Recipes</h2>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {mealPrepRecipes.map(r => (
          <a href={`/meal-prep/recipes/${r.slug}/`} class="group rounded-2xl overflow-hidden border transition-all hover:shadow-lg hover:-translate-y-1" style="border-color: var(--border-default); background: var(--bg-secondary);">
            <div class="aspect-video overflow-hidden relative">
              <img
                src={`/images/recipes/${r.slug}.jpg`}
                onerror={`this.onerror=null;this.src='${fallbackImage}'`}
                alt={r.imageAlt || r.title}
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                width="400"
                height="225"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
              <div class="absolute bottom-3 left-3">
                <span class="px-2 py-1 rounded text-[9px] font-black uppercase" style="background-color: var(--accent-primary); color: var(--text-inverse);">{r.protein}g protein</span>
              </div>
            </div>
            <div class="p-4">
              <h3 class="font-black text-sm mb-2 leading-tight group-hover:opacity-80 transition-opacity">{r.title}</h3>
              <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                <span>{r.calories} cal</span>
                <span>·</span>
                <span>{r.prepTime + r.cookTime}m total</span>
                <span>·</span>
                <span>{r.servings} servings</span>
              </div>
            </div>
          </a>
        ))}
      </div>
      <div class="text-center mt-10">
        <a href="/meal-prep/method/crockpot/" class="inline-flex items-center gap-2 text-xs font-black uppercase tracking-widest transition-colors" style="color: var(--accent-primary);">
          Browse All Recipes
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
        </a>
      </div>
    </section>

    <!-- FACET MEGA-NAV -->
    <FacetNav layout="columns" sectionTitle="Universal Taxonomy" badge="54 Active Dimensions" groups={facetGroups} />

    <!-- EXPLORE BY BLOCKS — Internal link density for T1 hub -->
    <ExploreByBlock headline="EXPLORE ALL CATEGORIES" subtitle="Full Taxonomy Navigation" columns={exploreColumns} variant="light" />

    <!-- DATA STREAM -->
    <section class="py-12 relative" style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-default);">
      <div class="data-stream overflow-hidden whitespace-nowrap flex py-2" style="border-top: 1px solid var(--accent-glow); border-bottom: 1px solid var(--accent-glow);">
        <div class="flex animate-marquee gap-8 items-center">
          {[1,2,3,4,5].map(() => (
            <div class="flex gap-8 items-center">
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--accent-primary);">INDEX UPDATED: 2024-05-12</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--text-tertiary);">NEW CLUSTER: POSTPARTUM FREEZER STASH [54 PAGES]</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--accent-primary);">TRAFFIC WINNER: CROCKPOT NO-MICROWAVE</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
            </div>
          ))}
        </div>
      </div>
    </section>
  </main>

  <FooterNav site="mealprepideas" />
</BaseLayout>
