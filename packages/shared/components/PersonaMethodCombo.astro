---
/**
 * PersonaMethodCombo — Persona + Method Combo (T3)
 * Converted from: persona___method_combo__t3_.html (updated to dark design)
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import BreadcrumbNav from './BreadcrumbNav.astro';

interface Recipe {
  id: number; title: string; protein: string; cal: string; method?: string; tag: string;
}
interface FAQ { question: string; answer: string; }

interface Props {
  title: string; description?: string; canonicalUrl?: string;
  hub: string; facetA: { type: string; value: string }; facetB: { type: string; value: string };
  headline: string; headlineAccent: string; subheadline: string;
  recipes?: Recipe[]; faqs?: FAQ[];
  siblings?: { href: string; label: string; sublabel?: string }[];
}

const { title, description, canonicalUrl, hub, facetA, facetB, headline, headlineAccent, subheadline, recipes = [], faqs = [], siblings = [] } = Astro.props;
const hubPath = hub === 'meal-prep' ? '/meal-prep/' : '/high-protein/';
const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: hub === 'meal-prep' ? 'Meal Prep' : 'High Protein', href: hubPath },
  { label: `${headline} × ${headlineAccent}` },
];
const recipesJson = JSON.stringify(recipes);
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl}>
  <HeaderNav />

  <main class="flex-grow" x-data={`{ filter: 'all', faqOpen: null, recipes: ${recipesJson} }`}>
    <!-- HERO -->
    <section class="relative pt-20 pb-20 px-6 border-b border-zinc-900 overflow-hidden">
      <div class="max-w-7xl mx-auto relative z-10">
        <BreadcrumbNav items={breadcrumbs} />
        <div class="mt-8 grid md:grid-cols-12 gap-12">
          <div class="md:col-span-8">
            <span class="bg-[#D9FF00] text-black text-[10px] font-black px-2 py-0.5 rounded uppercase tracking-widest inline-block mb-6">T3: Persona × Method</span>
            <h1 class="text-5xl md:text-7xl font-black tracking-tighter leading-none mb-6">
              {headline} <span class="text-[#D9FF00]">{headlineAccent}</span>
            </h1>
            <p class="text-xl text-zinc-400 max-w-2xl leading-relaxed mb-8">{subheadline}</p>
            <div class="flex flex-wrap gap-4">
              <a href="#recipes" class="bg-[#D9FF00] text-black px-8 py-4 rounded-xl font-black uppercase text-xs tracking-widest hover:bg-white transition-all">View Protocols</a>
              <a href="#" class="border border-zinc-700 hover:border-white px-8 py-4 rounded-xl font-black uppercase text-xs tracking-widest transition-all">Download Plan</a>
            </div>
          </div>
          <div class="md:col-span-4">
            <div class="hyper-border rounded-3xl p-8">
              <div class="scanner-line"></div>
              <h3 class="text-[10px] font-black tracking-widest text-zinc-500 uppercase mb-6">Persona Profile</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center border-b border-zinc-800 pb-3">
                  <span class="text-xs font-bold text-zinc-500">Persona</span>
                  <span class="text-sm font-black">{headline}</span>
                </div>
                <div class="flex justify-between items-center border-b border-zinc-800 pb-3">
                  <span class="text-xs font-bold text-zinc-500">Method</span>
                  <span class="text-sm font-black text-[#D9FF00]">{headlineAccent}</span>
                </div>
                <div class="flex justify-between items-center border-b border-zinc-800 pb-3">
                  <span class="text-xs font-bold text-zinc-500">Protocols</span>
                  <span class="text-sm font-black">{recipes.length}+</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RECIPE LIST -->
    <section id="recipes" class="py-24 px-6">
      <div class="max-w-7xl mx-auto">
        <h2 class="text-4xl font-black tracking-tighter mb-12">Ranked Protocols</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <template x-for="(recipe, index) in recipes" x-bind:key="recipe.id">
            <div class="hyper-border rounded-2xl p-6 group hover:border-[#D9FF00] transition-all">
              <div class="flex justify-between items-start mb-4">
                <span class="text-3xl font-black text-zinc-800 group-hover:text-[#D9FF00]/50 transition-colors" x-text="index + 1"></span>
                <span class="bg-zinc-800 text-[9px] font-black px-2 py-1 rounded uppercase tracking-widest" x-text="recipe.tag"></span>
              </div>
              <h4 class="text-xl font-black tracking-tight mb-4 group-hover:text-[#D9FF00] transition-colors" x-text="recipe.title"></h4>
              <div class="grid grid-cols-2 gap-3">
                <div class="bg-zinc-950 p-3 rounded-xl border border-zinc-800 text-center">
                  <span class="text-[9px] font-bold text-zinc-500 uppercase block">Protein</span>
                  <span class="text-lg font-black text-[#D9FF00]" x-text="recipe.protein"></span>
                </div>
                <div class="bg-zinc-950 p-3 rounded-xl border border-zinc-800 text-center">
                  <span class="text-[9px] font-bold text-zinc-500 uppercase block">Calories</span>
                  <span class="text-lg font-black" x-text="recipe.cal"></span>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
    </section>

    <!-- SIBLINGS -->
    {siblings.length > 0 && (
      <section class="py-20 px-6 border-t border-zinc-900">
        <div class="max-w-7xl mx-auto">
          <h3 class="text-3xl font-black tracking-tight mb-8">Related Nodes</h3>
          <div class="grid md:grid-cols-4 gap-4">
            {siblings.map(sib => (
              <a href={sib.href} class="p-6 bg-zinc-900 border border-zinc-800 rounded-2xl hover:border-[#D9FF00] transition-all group">
                <div class="text-[10px] font-black text-zinc-600 group-hover:text-[#D9FF00] mb-2">{sib.sublabel || 'RELATED'}</div>
                <div class="font-bold text-sm">{sib.label}</div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- FAQ -->
    {faqs.length > 0 && (
      <section class="py-24 px-6 max-w-4xl mx-auto">
        <h4 class="text-4xl font-black tracking-tighter mb-12 text-center">FAQ</h4>
        <div class="space-y-4">
          {faqs.map((faq, i) => (
            <div class="border border-zinc-800 rounded-2xl overflow-hidden">
              <button x-on:click={`faqOpen === ${i} ? faqOpen = null : faqOpen = ${i}`} class="w-full flex justify-between items-center p-6 text-left hover:bg-zinc-900 transition-colors">
                <span class="text-sm font-black">{faq.question}</span>
                <span class="text-2xl font-black text-[#D9FF00]" x-text={`faqOpen === ${i} ? '−' : '+'`}></span>
              </button>
              <div x-show={`faqOpen === ${i}`} x-cloak class="p-6 bg-zinc-900/50 border-t border-zinc-800 text-zinc-400 text-sm leading-relaxed">{faq.answer}</div>
            </div>
          ))}
        </div>
      </section>
    )}
  </main>

  <FooterNav copyrightSuffix="Index Authority Network. T3: Persona × Method." />
</BaseLayout>
