---
/**
 * SitemapPage — Human-readable site directory
 * Lists all major sections, facets, recipes, plans, stores, tools
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import { recipes } from '../data/content/recipes';
import { plans } from '../data/content/plans';
import { stores } from '../data/content/stores';
import { facets } from '../data/taxonomy';

function slugToDisplay(slug: string): string {
  return slug.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
}

interface Props {
  site?: 'mealprepideas' | 'proteinmeals';
}

const siteUrl = Astro.site?.href || Astro.site?.toString() || '';
const autoSite = siteUrl.includes('proteinmeals') ? 'proteinmeals' : 'mealprepideas';
const { site = autoSite } = Astro.props;
const isProtein = site === 'proteinmeals';
const siteName = isProtein ? 'ProteinMeals.co' : 'MealPrepIdeas.co';
const hubPath = isProtein ? '/high-protein/' : '/meal-prep/';
const hubLabel = isProtein ? 'High Protein' : 'Meal Prep';
const otherHubPath = isProtein ? '/meal-prep/' : '/high-protein/';
const otherHubLabel = isProtein ? 'Meal Prep' : 'High Protein';

// Get recipes for this hub
const hubRecipes = recipes.filter(r => r.hub === (isProtein ? 'high-protein' : 'meal-prep'));
const otherRecipes = recipes.filter(r => r.hub !== (isProtein ? 'high-protein' : 'meal-prep'));
const hubPlans = plans.filter(p => p.hub === (isProtein ? 'high-protein' : 'meal-prep'));

// Facet types
const facetTypes = ['meal', 'method', 'diet', 'goal', 'constraint', 'ingredient', 'persona', 'store', 'chain'] as const;
---

<BaseLayout title={`Sitemap | ${siteName}`} description={`Complete site directory for ${siteName}. Browse all recipes, methods, diets, goals, personas, stores, plans, and tools.`}>
  <HeaderNav site={site} />

  <main class="flex-grow py-16 px-6 max-w-7xl mx-auto">
    <div class="mb-12">
      <span class="text-[10px] font-black uppercase tracking-widest block mb-4" style="color: var(--accent-primary);">Site Directory</span>
      <h1 class="text-5xl md:text-7xl font-black tracking-tighter leading-none mb-4">Sitemap</h1>
      <p class="text-lg" style="color: var(--text-secondary);">Everything on {siteName}, organized for humans.</p>
      <p class="text-sm mt-2" style="color: var(--text-tertiary);">Looking for the XML sitemap? <a href="/sitemap-index.xml" class="underline" style="color: var(--accent-primary);">sitemap-index.xml</a></p>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-12">

      <!-- Main Pages -->
      <div>
        <h2 class="text-xs font-black uppercase tracking-widest mb-4 pb-2 border-b" style="color: var(--accent-primary); border-color: var(--border-default);">Main Pages</h2>
        <ul class="space-y-2 text-sm font-medium" style="color: var(--text-secondary);">
          <li><a href="/" class="hover:underline">Home</a></li>
          <li><a href={hubPath} class="hover:underline">{hubLabel} Hub</a></li>
          <li><a href={otherHubPath} class="hover:underline">{otherHubLabel} Hub</a></li>
          <li><a href="/stores/" class="hover:underline">Store Directory</a></li>
          <li><a href="/tools/" class="hover:underline">Tools</a></li>
          <li><a href="/profile/" class="hover:underline">Profile</a></li>
          <li><a href="/privacy/" class="hover:underline">Privacy Policy</a></li>
          <li><a href="/terms/" class="hover:underline">Terms of Service</a></li>
        </ul>
      </div>

      <!-- Facet Indexes -->
      {facetTypes.map(ft => {
        const values = facets[ft]?.values || [];
        if (values.length === 0) return null;
        return (
          <div>
            <h2 class="text-xs font-black uppercase tracking-widest mb-4 pb-2 border-b" style="color: var(--accent-primary); border-color: var(--border-default);">
              {slugToDisplay(ft)} <span style="color: var(--text-tertiary);">({values.length})</span>
            </h2>
            <ul class="space-y-1.5 text-sm font-medium" style="color: var(--text-secondary);">
              <li><a href={`${hubPath}${ft}/`} class="hover:underline font-bold">All {slugToDisplay(ft)}s →</a></li>
              {values.map(v => (
                <li><a href={`${hubPath}${ft}/${v}/`} class="hover:underline">{slugToDisplay(v)}</a></li>
              ))}
            </ul>
          </div>
        );
      })}

      <!-- Recipes -->
      <div>
        <h2 class="text-xs font-black uppercase tracking-widest mb-4 pb-2 border-b" style="color: var(--accent-primary); border-color: var(--border-default);">
          {hubLabel} Recipes <span style="color: var(--text-tertiary);">({hubRecipes.length})</span>
        </h2>
        <ul class="space-y-1.5 text-sm font-medium" style="color: var(--text-secondary);">
          {hubRecipes.map(r => (
            <li><a href={`${hubPath}recipes/${r.slug}/`} class="hover:underline">{r.title}</a></li>
          ))}
        </ul>
      </div>

      <!-- Other Hub Recipes -->
      {otherRecipes.length > 0 && (
        <div>
          <h2 class="text-xs font-black uppercase tracking-widest mb-4 pb-2 border-b" style="color: var(--accent-primary); border-color: var(--border-default);">
            {otherHubLabel} Recipes <span style="color: var(--text-tertiary);">({otherRecipes.length})</span>
          </h2>
          <ul class="space-y-1.5 text-sm font-medium" style="color: var(--text-secondary);">
            {otherRecipes.map(r => (
              <li><a href={`${otherHubPath}recipes/${r.slug}/`} class="hover:underline">{r.title}</a></li>
            ))}
          </ul>
        </div>
      )}

      <!-- Plans -->
      <div>
        <h2 class="text-xs font-black uppercase tracking-widest mb-4 pb-2 border-b" style="color: var(--accent-primary); border-color: var(--border-default);">
          Meal Plans <span style="color: var(--text-tertiary);">({hubPlans.length})</span>
        </h2>
        <ul class="space-y-1.5 text-sm font-medium" style="color: var(--text-secondary);">
          {hubPlans.map(p => (
            <li><a href={`${hubPath}plans/${p.slug}/`} class="hover:underline">{p.title}</a></li>
          ))}
        </ul>
      </div>

      <!-- Stores -->
      <div>
        <h2 class="text-xs font-black uppercase tracking-widest mb-4 pb-2 border-b" style="color: var(--accent-primary); border-color: var(--border-default);">
          Stores &amp; Chains <span style="color: var(--text-tertiary);">({stores.length})</span>
        </h2>
        <ul class="space-y-1.5 text-sm font-medium" style="color: var(--text-secondary);">
          {stores.map(s => (
            <li><a href={`/stores/${s.slug}/`} class="hover:underline">{s.name}</a></li>
          ))}
        </ul>
      </div>

      <!-- Tools -->
      <div>
        <h2 class="text-xs font-black uppercase tracking-widest mb-4 pb-2 border-b" style="color: var(--accent-primary); border-color: var(--border-default);">Tools</h2>
        <ul class="space-y-1.5 text-sm font-medium" style="color: var(--text-secondary);">
          <li><a href="/tools/" class="hover:underline font-bold">All Tools →</a></li>
          <li><a href="/tools/meal-planner/" class="hover:underline">Meal Planner</a></li>
          <li><a href="/tools/grocery-list/" class="hover:underline">Grocery List Generator</a></li>
          <li><a href="/tools/nutrition-label/" class="hover:underline">Nutrition Label Generator</a></li>
          <li><a href="/tools/protein-cost/" class="hover:underline">Protein Cost Ranker</a></li>
          <li><a href="/tools/roi-calculator/" class="hover:underline">ROI Calculator</a></li>
          <li><a href="/tools/prep-quiz/" class="hover:underline">Prep Style Quiz</a></li>
          <li><a href="/tools/fridge-finder/" class="hover:underline">Fridge Finder</a></li>
          <li><a href="/tools/freezer-tracker/" class="hover:underline">Freezer Tracker</a></li>
          <li><a href="/tools/allergen-filter/" class="hover:underline">Allergen Filter</a></li>
          <li><a href="/tools/streak/" class="hover:underline">Meal Prep Streak</a></li>
        </ul>
      </div>

    </div>
  </main>

  <FooterNav site={site} />
</BaseLayout>
