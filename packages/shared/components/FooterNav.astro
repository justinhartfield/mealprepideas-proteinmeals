---
/**
 * FooterNav — Global Footer with Full Taxonomy Navigation
 * Combines "Explore All Categories" + site footer for better indexing
 * Uses CSS custom properties for light/dark adaptation
 */
import { facets } from '../data/taxonomy';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

function slugToLabel(slug: string): string {
  return slug.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
}

interface Props {
  site?: 'mealprepideas' | 'proteinmeals';
  brandName?: string;
  brandDescription?: string;
  copyrightSuffix?: string;
}

// Auto-detect site from the Astro site config URL
const siteUrl = Astro.site?.href || Astro.site?.toString() || '';
const autoSite = siteUrl.includes('proteinmeals') ? 'proteinmeals' : 'mealprepideas';

const {
  site = autoSite,
  brandName = site === 'proteinmeals' ? 'PROTEINMEALS.CO' : 'MEALPREPIDEAS.CO',
  brandDescription = site === 'proteinmeals'
    ? 'Your authority guide to high-protein nutrition. Recipes, macros, store guides, and meal plans for muscle gain and weight management.'
    : 'Your authority guide to meal prep. Batch cooking, storage logistics, 5-day plans, and store guides for efficient weekly nutrition.',
  copyrightSuffix = site === 'proteinmeals' ? 'ProteinMeals.co' : 'MealPrepIdeas.co',
} = Astro.props;

const isProtein = site === 'proteinmeals';
const hubPath = isProtein ? '/high-protein/' : '/meal-prep/';
const hubLabel = isProtein ? 'High Protein' : 'Meal Prep';

// Build taxonomy columns from facets data
const mealValues = facets.meal?.values || [];
const methodValues = facets.method?.values || [];
const dietValues = facets.diet?.values || [];
const goalValues = facets.goal?.values || [];
const constraintValues = facets.constraint?.values || [];

const taxonomyColumns = [
  {
    title: 'By Meal',
    titleHref: `${hubPath}meal/`,
    links: mealValues.map(v => ({
      label: slugToLabel(v),
      href: `${hubPath}meal/${v}/`,
    })),
  },
  {
    title: 'By Method',
    titleHref: `${hubPath}method/`,
    links: methodValues.map(v => ({
      label: slugToLabel(v),
      href: `${hubPath}method/${v}/`,
    })),
  },
  {
    title: 'By Diet',
    titleHref: `${hubPath}diet/`,
    links: dietValues.map(v => ({
      label: slugToLabel(v),
      href: `${hubPath}diet/${v}/`,
    })),
  },
  {
    title: 'By Goal & Constraint',
    titleHref: `${hubPath}goal/`,
    links: [
      ...goalValues.map(v => ({
        label: slugToLabel(v),
        href: `${hubPath}goal/${v}/`,
      })),
      ...constraintValues.map(v => ({
        label: slugToLabel(v),
        href: `${hubPath}constraint/${v}/`,
      })),
    ],
  },
].filter(col => col.links.length > 0);

// Footer link columns
const footerColumns = isProtein ? [
  {
    title: 'High Protein',
    links: [
      { href: '/high-protein/', label: 'High Protein Hub' },
      { href: '/high-protein/plans/high-protein-muscle-gain-5-day/', label: '5-Day Plans' },
      { href: '/high-protein/recipes/steak-and-egg-protein-plate/', label: 'Recipes' },
      { href: '/high-protein/goal/muscle-gain/', label: 'Muscle Gain' },
    ],
  },
  {
    title: 'Stores & Chains',
    links: [
      { href: '/stores/trader-joes/', label: "Trader Joe's" },
      { href: '/stores/costco/', label: 'Costco' },
      { href: '/stores/chick-fil-a/', label: 'Chick-fil-A' },
      { href: '/stores/chipotle/', label: 'Chipotle' },
      { href: '/stores/sweetgreen/', label: 'Sweetgreen' },
    ],
  },
  {
    title: 'Popular',
    links: [
      { href: '/high-protein/diet/keto/', label: 'Keto Protein' },
      { href: '/high-protein/diet/vegan/', label: 'Vegan Protein' },
      { href: '/high-protein/goal/weight-loss/', label: 'Weight Loss' },
      { href: '/high-protein/for/bariatric/', label: 'Bariatric' },
      { href: '/high-protein/for/postpartum/', label: 'Postpartum' },
    ],
  },
] : [
  {
    title: 'Meal Prep',
    links: [
      { href: '/meal-prep/', label: 'Meal Prep Hub' },
      { href: '/meal-prep/plans/beginner-meal-prep-5-day/', label: '5-Day Plans' },
      { href: '/meal-prep/recipes/greek-chicken-meal-prep-bowls/', label: 'Recipes' },
      { href: '/meal-prep/for/work/', label: 'Work Prep' },
    ],
  },
  {
    title: 'Stores & Chains',
    links: [
      { href: '/stores/trader-joes/', label: "Trader Joe's" },
      { href: '/stores/costco/', label: 'Costco' },
      { href: '/stores/walmart/', label: 'Walmart' },
      { href: '/stores/kroger/', label: 'Kroger' },
      { href: '/stores/aldi/', label: 'Aldi' },
    ],
  },
  {
    title: 'Popular',
    links: [
      { href: '/meal-prep/method/crockpot/', label: 'Crockpot Meals' },
      { href: '/meal-prep/method/air-fryer/', label: 'Air Fryer Prep' },
      { href: '/meal-prep/method/sheet-pan/', label: 'Sheet Pan Dinners' },
      { href: '/meal-prep/for/college/', label: 'College Budget' },
      { href: '/meal-prep/for/kids/', label: 'Kid-Friendly' },
    ],
  },
];

// i18n
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<!-- EXPLORE ALL CATEGORIES — Full Taxonomy Navigation -->
{taxonomyColumns.length > 0 && (
  <section style="background-color: var(--bg-secondary); border-top: 1px solid var(--border-default);" class="py-24">
    <div class="px-6 max-w-7xl mx-auto">
      <div class="mb-16">
        <span class="text-[10px] font-black tracking-[0.5em] uppercase mb-4 block" style="color: var(--text-secondary);">{t('footer.fullTaxNav')}</span>
        <h2 class="text-5xl md:text-7xl font-black tracking-tighter leading-none">{t('footer.exploreAllCats')}</h2>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
        {taxonomyColumns.map((col) => (
          <div class="space-y-6">
            <a href={col.titleHref} class="text-xs font-black uppercase tracking-widest pb-2 flex justify-between group transition-colors" style="border-bottom: 2px solid var(--text-primary); color: var(--text-primary);">
              <span class="group-hover-accent-text transition-colors">{col.title} →</span>
            </a>
            <ul class="space-y-4">
              {col.links.map((link) => (
                <li>
                  <a href={link.href} class="text-xl font-black tracking-tight flex items-center justify-between group" style="color: var(--text-primary);">
                    <span class="group-hover-accent-text transition-colors">{link.label}</span>
                    <svg class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path>
                    </svg>
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </div>
  </section>
)}

<!-- SITE FOOTER -->
<footer class="py-20 px-6" style="background-color: var(--bg-primary); border-top: 1px solid var(--border-default);">
  <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-5 gap-12">
    <div class="col-span-2">
      <div class="flex items-center gap-2 mb-6 group cursor-pointer">
        <div class="w-3 h-3 rounded-full group-hover:scale-150 transition-transform" style="background-color: var(--accent-primary);"></div>
        <span class="text-xl font-black tracking-tighter italic" style="color: var(--text-primary);">{brandName}</span>
      </div>
      <p class="text-sm max-w-xs mb-8 leading-relaxed font-medium" style="color: var(--text-secondary);">{brandDescription}</p>
      <div class="flex space-x-4">
        {['IG', 'TW', 'YT'].map(label => (
          <div class="w-10 h-10 rounded flex items-center justify-center cursor-pointer font-black text-xs transition-all"
               style="border: 1px solid var(--border-default); color: var(--text-secondary);">
            {label}
          </div>
        ))}
      </div>
    </div>

    {footerColumns.map((col) => (
      <div>
        <h6 class="text-[10px] font-black uppercase tracking-widest mb-6" style="color: var(--text-tertiary);">{col.title}</h6>
        <ul class="space-y-4 text-xs font-bold" style="color: var(--text-secondary);">
          {col.links.map((link) => (
            <li>
              <a href={link.href} class="transition-colors hover-accent-text">{link.label}</a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </div>

  <div class="max-w-7xl mx-auto mt-20 pt-8 flex flex-col md:flex-row justify-between items-center gap-4"
       style="border-top: 1px solid var(--border-default);">
    <span class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--text-tertiary);">© 2026 {copyrightSuffix}</span>
    <div class="flex gap-8">
      {[
        { label: t('footer.privacy'), href: '/privacy/' },
        { label: t('footer.terms'), href: '/terms/' },
        { label: t('footer.sitemap'), href: '/sitemap/' },
      ].map(item => (
        <a href={item.href} class="text-[10px] font-bold uppercase tracking-widest transition-colors hover-accent-text" style="color: var(--text-tertiary);">{item.label}</a>
      ))}
    </div>
  </div>
</footer>
