---
/**
 * SingleFacetCategory.astro — T2 Single-Facet Category page
 * Converted from: persona_category__t2_.html + diet_category__t2_.html
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import type { FacetKey, HubId } from '../data/taxonomy';

export interface RecipeItem {
  id: number;
  title: string;
  category?: string;
  tags: string[];
  time?: string;
  protein?: string;
  cal?: string;
  method?: string;
  img?: string;
}

export interface UseCaseItem {
  number: string;
  title: string;
  description: string;
}

export interface FaqItem {
  question: string;
  answer: string;
}

export interface Props {
  hub: HubId;
  facetType: FacetKey;
  facetValue: string;
  title: string;
  description?: string;
  canonicalUrl?: string;
  headline: string;
  headlineAccent: string;
  subheadline: string;
  useCases?: UseCaseItem[];
  recipes?: RecipeItem[];
  faqs?: FaqItem[];
  relatedLinks?: { label: string; href: string; category: string }[];
}

const {
  hub,
  facetType,
  facetValue,
  title,
  description,
  canonicalUrl,
  headline,
  headlineAccent,
  subheadline,
  useCases = [],
  recipes = [],
  faqs = [],
  relatedLinks = [],
} = Astro.props;

const isMealPrep = hub === 'meal-prep';
const accentColor = isMealPrep ? 'emerald' : 'orange';
const hubPath = isMealPrep ? '/meal-prep' : '/high-protein';
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl}>
    <!-- Navigation -->
    <nav class="sticky top-0 z-40 w-full border-b border-black/5 bg-white/80 backdrop-blur-md px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="/" class="flex items-center gap-4 group">
                <div class={`w-10 h-10 bg-slate-900 flex items-center justify-center rounded-lg text-white font-bold text-xl group-hover:bg-${accentColor}-600 transition-colors`}>M</div>
                <span class="font-extrabold tracking-tighter text-2xl uppercase">Systemic Meals</span>
            </a>
            <div class="hidden md:flex gap-8 text-xs font-bold uppercase tracking-widest opacity-60">
                <a href="/meal-prep/" class="hover:opacity-100 transition-opacity">Meal Prep Hub</a>
                <a href="/high-protein/" class="hover:opacity-100 transition-opacity">High Protein Hub</a>
            </div>
            <button class="text-[10px] font-black tracking-widest border-2 border-slate-900 px-4 py-2 rounded hover:bg-slate-900 hover:text-white transition-all uppercase">Account</button>
        </div>
    </nav>

    <main class="flex-grow" x-data={`{ filter: 'all', faqOpen: null }`}>
        <!-- T2 Hero -->
        <header class="relative pt-20 pb-12 px-6 overflow-hidden">
            <div class="max-w-7xl mx-auto grid lg:grid-cols-12 gap-12 items-center">
                <div class="lg:col-span-7">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="label-text capitalize">{facetType} Protocol</span>
                        <span class="h-[1px] w-12 bg-slate-900/10"></span>
                        <span class="text-[10px] font-bold opacity-40 uppercase tracking-widest capitalize">{facetValue.replace(/-/g, ' ')} System</span>
                    </div>
                    <h1 class="text-6xl md:text-8xl font-black tracking-tighter leading-[0.85] mb-8">
                        {headline} <br>
                        <span class={`text-${accentColor}-700`}>{headlineAccent}</span>
                    </h1>
                    <p class="text-xl opacity-70 max-w-xl mb-10 leading-relaxed">{subheadline}</p>

                    {useCases.length > 0 && (
                        <div class="grid sm:grid-cols-3 gap-6">
                            {useCases.map((uc) => (
                                <div class="p-4 bg-white border border-black/5 rounded-xl">
                                    <span class={`block text-${accentColor}-600 font-black mb-1`}>{uc.number}</span>
                                    <span class="text-xs font-medium opacity-60">{uc.description}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
                <div class="lg:col-span-5 relative">
                    <div class="aspect-square bg-slate-900 rounded-[3rem] overflow-hidden rotate-3 shadow-2xl relative">
                        <img src="https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=800&auto=format&fit=crop" alt={`${facetValue} meal prep`} class="w-full h-full object-cover opacity-80" />
                    </div>
                </div>
            </div>
        </header>

        <!-- Recipe Grid -->
        <section class="max-w-7xl mx-auto px-6 py-20">
            <div class="text-center mb-12">
                <span class="label-text mb-4">Data Pool</span>
                <h2 class="text-4xl font-black tracking-tight">The Recipe Catalog.</h2>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                {recipes.map((recipe) => (
                    <div class="pantry-card group rounded-3xl p-6 flex flex-col justify-between aspect-[4/5] relative overflow-hidden">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-4">
                                <span class="label-text">{recipe.category || facetValue}</span>
                                {recipe.time && <span class="text-[10px] font-bold opacity-30 group-hover:opacity-100 transition-opacity">{recipe.time}</span>}
                            </div>
                            <h3 class={`text-2xl font-black leading-tight mb-4 group-hover:text-${accentColor}-700 transition-colors`}>{recipe.title}</h3>
                            <div class="flex flex-wrap gap-2">
                                {recipe.tags.map((tag) => (
                                    <span class="px-2 py-1 bg-slate-50 border border-black/5 rounded text-[9px] font-bold uppercase tracking-tight">{tag}</span>
                                ))}
                            </div>
                        </div>
                        <div class="relative z-10 flex justify-between items-end">
                            <span class="text-[10px] font-black underline underline-offset-4 cursor-pointer hover:text-emerald-700">VIEW PROTOCOL</span>
                        </div>
                        <div class="absolute bottom-0 right-0 w-32 h-32 bg-slate-50 -mr-16 -mb-16 rounded-full group-hover:scale-150 transition-transform duration-700 -z-0"></div>
                    </div>
                ))}
            </div>
        </section>

        <!-- Cross-System Navigation -->
        {relatedLinks.length > 0 && (
            <section class="bg-slate-900 text-white py-24 px-6 overflow-hidden relative">
                <div class="max-w-7xl mx-auto relative z-10">
                    <div class="mb-16 max-w-2xl">
                        <span class={`label-text !bg-white/10 !text-white !border-${accentColor}-400 mb-6`}>Cross-System Navigation</span>
                        <h2 class="text-4xl md:text-5xl font-black tracking-tight mb-6">Expand your logistics.</h2>
                    </div>
                    <div class="grid md:grid-cols-3 gap-8">
                        {['By Goal', 'By Constraint', 'By Method'].map((category) => {
                            const links = relatedLinks.filter((l) => l.category === category);
                            return links.length > 0 ? (
                                <div class="space-y-6">
                                    <h4 class={`text-xs font-black uppercase tracking-widest text-${accentColor}-400`}>{category}</h4>
                                    <ul class="space-y-4">
                                        {links.map((link) => (
                                            <li><a href={link.href} class="text-xl font-bold hover:translate-x-2 transition-transform inline-block">{link.label} →</a></li>
                                        ))}
                                    </ul>
                                </div>
                            ) : null;
                        })}
                    </div>
                </div>
            </section>
        )}

        <!-- FAQ Block -->
        {faqs.length > 0 && (
            <section class="max-w-4xl mx-auto py-24 px-6">
                <div class="text-center mb-16">
                    <span class="label-text mb-4">Common Protocols</span>
                    <h3 class="text-4xl font-black">Frequently Asked.</h3>
                </div>
                <div class="space-y-4">
                    {faqs.map((faq, i) => (
                        <div class="bg-white border border-black/5 rounded-2xl overflow-hidden">
                            <button @click={`faqOpen = (faqOpen === ${i} ? null : ${i})`} class="w-full px-8 py-6 text-left flex justify-between items-center group">
                                <span class={`font-bold text-lg group-hover:text-${accentColor}-700 transition-colors`}>{faq.question}</span>
                                <span class="text-2xl transition-transform duration-300" x-bind:class={`faqOpen === ${i} ? 'rotate-45' : ''`}>+</span>
                            </button>
                            <div x-show={`faqOpen === ${i}`} x-cloak class="px-8 pb-6 text-slate-500 text-sm leading-relaxed">{faq.answer}</div>
                        </div>
                    ))}
                </div>
            </section>
        )}
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white py-16 px-6">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-white text-slate-900 flex items-center justify-center rounded-md font-black">M</div>
                <span class="font-black text-xl tracking-tighter uppercase">The System Network</span>
            </div>
            <p class="text-[10px] font-bold text-slate-500 tracking-widest uppercase">© 2024 Systemic Meals Network. {hubPath}/{facetType}/{facetValue}/</p>
        </div>
    </footer>
</BaseLayout>
