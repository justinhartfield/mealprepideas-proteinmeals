---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
/**
 * FacetNav — Theme-aware chip-based facet navigation
 * Uses CSS custom properties for light/dark adaptation
 */
interface FacetGroup {
  title: string;
  titleHref?: string;
  items: { label: string; href: string; active?: boolean }[];
}

interface Props {
  chips?: { label: string; href: string }[];
  groups?: FacetGroup[];
  sectionTitle?: string;
  badge?: string;
  layout?: 'chips' | 'columns';
}

const {
  chips = [],
  groups = [],
  sectionTitle = 'Browse Global Facets',
  badge,
  layout = 'chips',
} = Astro.props;

// i18n
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

{layout === 'chips' ? (
  <section class="py-12" style="border-top: 1px solid var(--border-default); border-bottom: 1px solid var(--border-default); background: var(--bg-tertiary);">
    <div class="px-6 max-w-7xl mx-auto">
      <div class="flex items-center justify-between mb-8">
        <h4 class="text-xs font-black tracking-[0.3em] uppercase" style="color: var(--text-tertiary);">{sectionTitle}</h4>
        {badge && (
          <span class="text-[10px] font-black uppercase px-3 py-1 rounded"
                style="background-color: var(--accent-primary); color: var(--text-inverse);">{badge}</span>
        )}
      </div>
      <div class="flex flex-wrap gap-3">
        {chips.map((chip) => (
          <a href={chip.href} class="hyper-border px-4 py-2 text-[11px] font-bold uppercase tracking-widest flex items-center gap-3 rounded transition-colors">
            <span class="w-1.5 h-1.5" style="background: var(--text-tertiary);"></span>
            <span style="color: var(--text-secondary);">{chip.label}</span>
          </a>
        ))}
      </div>
    </div>
  </section>
) : (
  <section class="py-24 overflow-hidden" style="background: var(--bg-primary); border-top: 1px solid var(--border-default); border-bottom: 1px solid var(--border-default);">
    <div class="px-6 max-w-7xl mx-auto">
      <div class="flex flex-col md:flex-row md:items-end justify-between mb-16 gap-8">
        <div>
          <h2 class="text-xs font-black tracking-[0.5em] uppercase mb-4 italic" style="color: var(--text-tertiary);">The Global Index</h2>
          <h3 class="text-5xl font-black tracking-tighter leading-none uppercase" style="color: var(--text-primary);">{sectionTitle}</h3>
        </div>
        {badge && (
          <div class="flex gap-2">
            <span class="text-[10px] font-black uppercase px-3 py-1 rounded"
                  style="background-color: var(--accent-primary); color: var(--text-inverse);">{badge}</span>
          </div>
        )}
      </div>
      <div class:list={['grid gap-12', groups.length <= 4 ? 'grid-cols-2 md:grid-cols-4' : 'grid-cols-2 md:grid-cols-4 lg:grid-cols-6']}>
        {groups.map((group) => (
          <div>
            {group.titleHref ? (
              <a href={group.titleHref} class="block text-[10px] font-black uppercase tracking-widest mb-6 pb-2 transition-colors hover-accent-text"
                 style="color: var(--text-tertiary); border-bottom: 1px solid var(--border-default);">{group.title} →</a>
            ) : (
              <h4 class="text-[10px] font-black uppercase tracking-widest mb-6 pb-2"
                  style="color: var(--text-tertiary); border-bottom: 1px solid var(--border-default);">{group.title}</h4>
            )}
            <ul class="space-y-3">
              {group.items.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class="text-xs font-bold transition-colors"
                    style={item.active ? 'color: var(--accent-primary);' : 'color: var(--text-secondary);'}
                  >
                    {item.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </div>
  </section>
)}
