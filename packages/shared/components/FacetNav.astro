---
/**
 * FacetNav.astro â€” Chip-based mega-nav for browsing facets
 * Used in T1 hub pages and T2 category pages for taxonomy exploration.
 */
import { facets, type FacetKey } from '../data/taxonomy';

export interface Props {
  hubPath: string;
  visibleFacets?: FacetKey[];
  activeFacet?: FacetKey;
  accentColor?: string;
}

const {
  hubPath,
  visibleFacets = ['method', 'diet', 'goal', 'persona'],
  activeFacet,
  accentColor = 'emerald',
} = Astro.props;
---

<div class="bg-white rounded-[32px] border border-black/5 p-8 md:p-12 shadow-sm" x-data={`{ activeTab: '${activeFacet || visibleFacets[0]}' }`}>
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6">
        <div>
            <h3 class="text-3xl font-black tracking-tight mb-2">Explore the Taxonomy</h3>
            <p class="opacity-50 text-sm font-medium">Browse by facet to find your specific protocol.</p>
        </div>
        <div class="flex bg-slate-100 p-1.5 rounded-2xl gap-2">
            {visibleFacets.map((key) => (
                <button
                    @click={`activeTab = '${key}'`}
                    x-bind:class={`activeTab === '${key}' ? 'bg-white shadow-md' : 'opacity-40'`}
                    class="px-6 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all"
                >
                    {facets[key].label}
                </button>
            ))}
        </div>
    </div>

    {visibleFacets.map((key, i) => (
        <div
            x-show={`activeTab === '${key}'`}
            x-cloak={i > 0}
            x-transition
            class="grid gap-3"
            style="grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));"
        >
            {facets[key].values.map((v) => (
                <a
                    href={`${hubPath}/${key}/${v}/`}
                    class="mega-chip bg-slate-50 p-4 rounded-2xl text-center border border-black/10 hover:bg-slate-900 hover:text-white transition-all"
                >
                    <span class="block text-xs font-black capitalize">{String(v).replace(/-/g, ' ')}</span>
                </a>
            ))}
        </div>
    ))}
</div>
