---
/**
 * DietCategory — Diet Category Page (T2)
 * Converted from: diet_category_page__t2_.html
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import BreadcrumbNav from './BreadcrumbNav.astro';
import ExploreByBlock from './ExploreByBlock.astro';

interface Recipe {
  id: number;
  title: string;
  protein: string;
  cal: string;
  pe?: string;
  tags: string[];
}

interface FAQ {
  question: string;
  answer: string;
}

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
  hub: string;
  facetType: string;
  facetValue: string;
  headline: string;
  headlineAccent?: string;
  definition?: string;
  definitionBullets?: string[];
  recipes?: Recipe[];
  faqs?: FAQ[];
  exploreColumns?: { title: string; links: { label: string; href: string }[] }[];
}

const {
  title, description, canonicalUrl, hub, facetType, facetValue,
  headline, headlineAccent, definition,
  definitionBullets = [],
  recipes = [],
  faqs = [],
  exploreColumns = [],
} = Astro.props;

const hubPath = hub === 'meal-prep' ? '/meal-prep/' : '/high-protein/';
const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: hub === 'meal-prep' ? 'Meal Prep' : 'High Protein', href: hubPath },
  { label: facetType.charAt(0).toUpperCase() + facetType.slice(1), href: `${hubPath}${facetType}/` },
  { label: headline },
];

const recipesJson = JSON.stringify(recipes);
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl}>
  <HeaderNav statusText={`Ref: ${hubPath}${facetType}/${facetValue}/`} />

  <main class="flex-grow" x-data={`{ filter: 'all', faqOpen: null, recipes: ${recipesJson} }`}>
    <!-- BREADCRUMB + HERO -->
    <section class="relative pt-20 pb-12 px-6 border-b border-zinc-900">
      <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-12 items-end">
        <div class="lg:col-span-8">
          <BreadcrumbNav items={breadcrumbs} />
          <h1 class="text-7xl md:text-9xl font-black tracking-tighter leading-[0.85] mb-8">{headline}<br/>{headlineAccent || 'PROTEIN.'}</h1>
          {definition && (
            <div class="max-w-2xl bg-zinc-900/50 border border-zinc-800 p-8 rounded-2xl">
              <h2 class="text-xs font-black uppercase tracking-[0.3em] text-[#D9FF00] mb-4">Functional Definition</h2>
              <p class="text-zinc-400 text-lg leading-relaxed font-medium mb-6" set:html={definition} />
              {definitionBullets.length > 0 && (
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {definitionBullets.map(bullet => (
                    <div class="flex items-start gap-3">
                      <div class="w-5 h-5 bg-[#D9FF00] rounded flex items-center justify-center mt-1">
                        <svg class="w-3 h-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                      </div>
                      <span class="text-sm font-bold text-zinc-300">{bullet}</span>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
        <div class="lg:col-span-4">
          <div class="hyper-border p-8 rounded-3xl bg-zinc-950">
            <div class="flex justify-between items-center mb-8">
              <span class="text-[10px] font-black uppercase tracking-widest text-zinc-500">P:E Efficiency Index</span>
              <span class="text-[#D9FF00] font-black italic">TOP TIER</span>
            </div>
            <div class="space-y-6">
              <div>
                <div class="flex justify-between text-[10px] font-black mb-2 uppercase tracking-widest">
                  <span>Protein Target</span><span>30-40%</span>
                </div>
                <div class="h-2 w-full bg-zinc-800 rounded-full overflow-hidden">
                  <div class="h-full pe-gradient w-[85%]"></div>
                </div>
              </div>
              <div class="pt-6 border-t border-zinc-800">
                <div class="flex items-center gap-4">
                  <span class="text-4xl font-black tabular-nums tracking-tighter">0.8+</span>
                  <p class="text-[10px] font-bold text-zinc-500 leading-tight uppercase">Average Protein Grams<br/>Per 10 Calories</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FILTER BAR -->
    <section class="sticky top-[73px] z-40 bg-zinc-950/80 backdrop-blur-md border-b border-zinc-900 px-6 py-4">
      <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-4">
        <div class="flex gap-2">
          {['All', 'Lunch', 'Dinner', 'Weight Loss'].map(f => (
            <button
              x-on:click={`filter = '${f === 'All' ? 'all' : f}'`}
              x-bind:class={`filter === '${f === 'All' ? 'all' : f}' ? 'bg-[#D9FF00] text-black' : 'bg-zinc-900 text-zinc-400'`}
              class="px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest transition-all"
            >{f}</button>
          ))}
        </div>
        <div class="text-[10px] font-black text-zinc-500 uppercase tracking-widest">
          Showing <span class="text-white" x-text="recipes.filter(r => filter === 'all' || r.tags.includes(filter)).length"></span> Valid Protocols
        </div>
      </div>
    </section>

    <!-- RECIPE GRID -->
    <section class="py-12 px-6 max-w-7xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="recipe in recipes" x-bind:key="recipe.id">
          <div x-show="filter === 'all' || recipe.tags.includes(filter)"
               x-transition:enter="transition ease-out duration-300"
               x-transition:enter-start="opacity-0 transform translate-y-4"
               x-transition:enter-end="opacity-100 transform translate-y-0"
               class="hyper-border rounded-2xl overflow-hidden group">
            <div class="aspect-video bg-zinc-800 relative overflow-hidden">
              <div class="scanner-line opacity-0 group-hover:opacity-100 transition-opacity"></div>
              <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 to-transparent"></div>
              <div class="absolute bottom-4 left-4 right-4 flex justify-between items-end">
                <div>
                  <h3 class="text-xl font-black tracking-tight" x-text="recipe.title"></h3>
                  <div class="flex gap-2 mt-2">
                    <template x-for="tag in recipe.tags">
                      <span class="text-[8px] font-black uppercase tracking-tighter bg-zinc-900/80 px-1.5 py-0.5 rounded border border-zinc-700" x-text="tag"></span>
                    </template>
                  </div>
                </div>
                <div class="text-right" x-show="recipe.pe">
                  <span class="text-[#D9FF00] text-lg font-black italic block leading-none" x-text="recipe.pe"></span>
                  <span class="text-[8px] font-bold text-zinc-400 uppercase tracking-widest">P:E Rating</span>
                </div>
              </div>
            </div>
            <div class="p-4 grid grid-cols-2 gap-4 border-t border-zinc-800">
              <div class="bg-zinc-950 p-3 rounded-xl border border-zinc-800">
                <span class="text-[9px] font-bold text-zinc-500 uppercase tracking-widest block mb-1">Protein</span>
                <span class="text-xl font-black tabular-nums" x-text="recipe.protein"></span>
              </div>
              <div class="bg-zinc-950 p-3 rounded-xl border border-zinc-800">
                <span class="text-[9px] font-bold text-zinc-500 uppercase tracking-widest block mb-1">Calories</span>
                <span class="text-xl font-black tabular-nums" x-text="recipe.cal"></span>
              </div>
            </div>
            <a href="#" class="block w-full py-4 text-center bg-zinc-900 group-hover:bg-[#D9FF00] group-hover:text-black transition-all text-[10px] font-black uppercase tracking-[0.2em]">
              View Recipe Structure
            </a>
          </div>
        </template>
      </div>
      <div class="mt-12 flex justify-center">
        <button class="bg-zinc-900 border border-zinc-800 hover:border-[#D9FF00] px-12 py-4 rounded-full text-[10px] font-black uppercase tracking-[0.3em] transition-all">
          Load Next 20 Entries
        </button>
      </div>
    </section>

    <!-- INTERNAL LINKS -->
    {exploreColumns.length > 0 && (
      <ExploreByBlock headline={`EXPLORE ${headline} FURTHER`} columns={exploreColumns} />
    )}

    <!-- FAQ -->
    {faqs.length > 0 && (
      <section class="py-24 px-6 max-w-4xl mx-auto">
        <h4 class="text-4xl font-black tracking-tighter mb-12 text-center">TECHNICAL FAQ</h4>
        <div class="space-y-4">
          {faqs.map((faq, index) => (
            <div class="border border-zinc-800 rounded-2xl overflow-hidden">
              <button
                x-on:click={`faqOpen === ${index} ? faqOpen = null : faqOpen = ${index}`}
                class="w-full flex justify-between items-center p-6 text-left hover:bg-zinc-900 transition-colors"
              >
                <span class="text-sm font-black uppercase tracking-wider">{faq.question}</span>
                <span class="text-2xl font-black text-[#D9FF00]" x-text={`faqOpen === ${index} ? '−' : '+'`}></span>
              </button>
              <div x-show={`faqOpen === ${index}`} x-cloak class="p-6 bg-zinc-900/50 border-t border-zinc-800 text-zinc-400 text-sm leading-relaxed">
                {faq.answer}
              </div>
            </div>
          ))}
        </div>
      </section>
    )}
  </main>

  <FooterNav copyrightSuffix="Index Authority Network. Diet Facet System T2." />
</BaseLayout>
