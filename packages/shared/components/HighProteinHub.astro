---
/**
 * HighProteinHub — High Protein Authority Hub (T1)
 * Theme-aware: uses CSS custom properties
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import FacetNav from './FacetNav.astro';
import ExploreByBlock from './ExploreByBlock.astro';
import { recipes } from '../data/content/recipes';
import { stores } from '../data/content/stores';
import { plans } from '../data/content/plans';
import {
  getTotalStrategies,
  getHighProteinRecipeCount,
  getHighProteinAverageProtein,
  getHighProteinAverageCalories,
  getStoreCount,
  getPlanCount,
  getFastFoodChains,
} from '../utils/stats';

const allHPRecipes = recipes.filter(r => r.hub === 'high-protein');
const highProteinRecipes = allHPRecipes.slice(0, 8);
const fallbackImage = '/images/placeholder.svg';

// Serialize recipe data for Alpine.js (lightweight payload)
const alpineRecipeData = JSON.stringify(
  allHPRecipes.map(r => ({
    slug: r.slug,
    title: r.title,
    protein: r.protein,
    calories: r.calories,
    imageAlt: r.imageAlt || r.title,
    prepTime: r.prepTime + r.cookTime,
    servings: r.servings,
    facets: {
      goal: r.facets.goal || null,
      diet: r.facets.diet || null,
      method: r.facets.method || null,
      constraint: r.facets.constraint || null,
    },
  }))
);

// Dynamic stats
const totalStrategies = getTotalStrategies();
const hpRecipeCount = getHighProteinRecipeCount();
const hpAvgProtein = getHighProteinAverageProtein();
const hpAvgCals = getHighProteinAverageCalories();
const storeCount = getStoreCount();
const planCount = getPlanCount();
const fastFoodChainCount = getFastFoodChains().length;

// Store abbreviation badges with links (canonical hub paths)
const storeBadges = [
  { abbr: 'TJ', slug: 'trader-joes', href: '/high-protein/store/trader-joes/' },
  { abbr: 'CO', slug: 'costco', href: '/high-protein/store/costco/' },
  { abbr: 'WM', slug: 'walmart', href: '/high-protein/store/walmart/' },
  { abbr: 'AL', slug: 'aldi', href: '/high-protein/store/aldi/' },
];

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
}

const { title, description, canonicalUrl } = Astro.props;

const facetGroups = [
  { title: 'By Diet', items: [
    { label: 'High Protein Vegan', href: '/high-protein/diet/vegan/' },
    { label: 'Vegetarian Protein', href: '/high-protein/diet/vegetarian/' },
    { label: 'Keto Protein Meals', href: '/high-protein/diet/keto/' },
    { label: 'Low Carb Protein', href: '/high-protein/diet/low-carb/' },
    { label: 'Low Calorie Bands', href: '/high-protein/diet/low-calorie/' },
    { label: 'Gluten-Free Macros', href: '/high-protein/diet/gluten-free/' },
    { label: 'Dairy-Free Muscle', href: '/high-protein/diet/dairy-free/' },
  ] },
  { title: 'By Method', items: [
    { label: 'Air Fryer Protein', href: '/high-protein/method/air-fryer/' },
    { label: 'Slow Cooker Batch', href: '/high-protein/method/slow-cooker/' },
    { label: 'Crockpot Protein', href: '/high-protein/method/crockpot/' },
    { label: 'Instant Pot High-Pro', href: '/high-protein/method/instant-pot/' },
    { label: 'Microwave Survival', href: '/high-protein/method/microwave/' },
    { label: 'Sheet Pan Protein', href: '/high-protein/method/sheet-pan/' },
    { label: 'One Pan Meals', href: '/high-protein/method/one-pan/' },
    { label: 'No-Cook Macros', href: '/high-protein/method/no-cook/' },
    { label: 'Freezer Protein', href: '/high-protein/method/freezer/' },
    { label: 'Grill Protein', href: '/high-protein/method/grill/' },
    { label: 'Oven Protein', href: '/high-protein/method/oven/' },
  ] },
  { title: 'By Constraint', items: [
    { label: 'High Fiber Protein', href: '/high-protein/constraint/high-fiber/' },
    { label: 'Low Sodium Choices', href: '/high-protein/constraint/low-sodium/' },
    { label: 'Low Fat Protein', href: '/high-protein/constraint/low-fat/' },
    { label: 'Budget Protein Prep', href: '/high-protein/constraint/budget/' },
    { label: 'Cheap Protein', href: '/high-protein/constraint/cheap/' },
    { label: 'Quick Protein', href: '/high-protein/constraint/quick/' },
    { label: 'Simple Protein', href: '/high-protein/constraint/simple/' },
    { label: 'For The Week', href: '/high-protein/constraint/for-the-week/' },
    { label: 'No-Microwave Lunch', href: '/high-protein/constraint/no-microwave/' },
  ] },
  { title: 'By Persona', items: [
    { label: 'Office Lunch Prep', href: '/high-protein/persona/work/' },
    { label: 'College Student Gains', href: '/high-protein/persona/college/' },
    { label: 'Picky Eater Hacks', href: '/high-protein/persona/picky-eaters/' },
    { label: 'Kids Protein', href: '/high-protein/persona/kids/' },
    { label: 'Toddler Protein', href: '/high-protein/persona/toddler/' },
    { label: 'Pregnancy Protein', href: '/high-protein/persona/pregnancy/' },
    { label: 'Postpartum Recovery', href: '/high-protein/persona/postpartum/' },
    { label: 'Bariatric Support', href: '/high-protein/persona/bariatric/' },
    { label: 'PCOS Protein', href: '/high-protein/persona/pcos/' },
    { label: 'Cholesterol Protein', href: '/high-protein/persona/cholesterol/' },
  ] },
  { title: 'By Ingredient', items: [
    { label: 'Chicken Breast Prep', href: '/high-protein/ingredient/chicken/' },
    { label: 'Ground Beef Protein', href: '/high-protein/ingredient/ground-beef/' },
    { label: 'Ground Turkey Ideas', href: '/high-protein/ingredient/ground-turkey/' },
    { label: 'Wild Salmon Prep', href: '/high-protein/ingredient/salmon/' },
    { label: 'Shrimp Meals', href: '/high-protein/ingredient/shrimp/' },
    { label: 'Lean Steak Meals', href: '/high-protein/ingredient/steak/' },
    { label: 'Salad Protein', href: '/high-protein/ingredient/salad/' },
  ] },
  { title: 'Popular Stores', items: [
    { label: "Trader Joe's", href: '/high-protein/store/trader-joes/' },
    { label: 'Costco', href: '/high-protein/store/costco/' },
    { label: 'Walmart', href: '/high-protein/store/walmart/' },
    { label: 'Aldi', href: '/high-protein/store/aldi/' },
    { label: 'Whole Foods', href: '/high-protein/store/whole-foods/' },
    { label: 'Kroger', href: '/high-protein/store/kroger/' },
    { label: 'Target', href: '/high-protein/store/target/' },
    { label: 'Sprouts', href: '/high-protein/store/sprouts/' },
  ] },
  { title: 'Popular Chains', items: [
    { label: 'Chick-fil-A', href: '/high-protein/chain/chick-fil-a/' },
    { label: "McDonald's", href: '/high-protein/chain/mcdonalds/' },
    { label: 'Chipotle', href: '/high-protein/chain/chipotle/' },
    { label: 'Panera', href: '/high-protein/chain/panera/' },
    { label: 'Subway', href: '/high-protein/chain/subway/' },
    { label: 'Sweetgreen', href: '/high-protein/chain/sweetgreen/' },
    { label: 'CAVA', href: '/high-protein/chain/cava/' },
    { label: 'Five Guys', href: '/high-protein/chain/five-guys/' },
  ] },
];

// ExploreByBlock columns for additional internal links
const exploreColumns = [
  {
    title: 'By Meal',
    links: [
      { label: 'Breakfast Protein', href: '/high-protein/meal/breakfast/' },
      { label: 'Lunch Protein', href: '/high-protein/meal/lunch/' },
      { label: 'Dinner Protein', href: '/high-protein/meal/dinner/' },
      { label: 'Protein Snacks', href: '/high-protein/meal/snacks/' },
    ],
  },
  {
    title: 'By Goal',
    links: [
      { label: 'Weight Loss Protein', href: '/high-protein/goal/weight-loss/' },
      { label: 'Muscle Gain Protein', href: '/high-protein/goal/muscle-gain/' },
      { label: 'Healthy Protein', href: '/high-protein/goal/healthy/' },
    ],
  },
  {
    title: 'By Diet',
    links: [
      { label: 'Vegan Protein', href: '/high-protein/diet/vegan/' },
      { label: 'Keto Protein', href: '/high-protein/diet/keto/' },
      { label: 'Low Carb Protein', href: '/high-protein/diet/low-carb/' },
      { label: 'Low Calorie', href: '/high-protein/diet/low-calorie/' },
      { label: 'Gluten Free', href: '/high-protein/diet/gluten-free/' },
      { label: 'Dairy Free', href: '/high-protein/diet/dairy-free/' },
      { label: 'Vegetarian', href: '/high-protein/diet/vegetarian/' },
    ],
  },
  {
    title: 'By Constraint',
    links: [
      { label: 'Budget Protein', href: '/high-protein/constraint/budget/' },
      { label: 'Quick Protein', href: '/high-protein/constraint/quick/' },
      { label: 'High Fiber', href: '/high-protein/constraint/high-fiber/' },
      { label: 'Low Sodium', href: '/high-protein/constraint/low-sodium/' },
      { label: 'Simple Protein', href: '/high-protein/constraint/simple/' },
      { label: 'For The Week', href: '/high-protein/constraint/for-the-week/' },
      { label: 'No Microwave', href: '/high-protein/constraint/no-microwave/' },
    ],
  },
];
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl}>
  <HeaderNav
    site="proteinmeals"
    activeLink="/high-protein/"
    statusText="LIVE FEED:"
    statusBadge="NEW TRADER JOE'S SKUS DETECTED"
  />

  <main class="flex-grow" x-data={`{
    query: { goal: 'any', diet: 'none', method: 'any', store: 'any' },
    allRecipes: ${alpineRecipeData},
    showResults: false,
    get filteredRecipes() {
      return this.allRecipes.filter(r => {
        if (this.query.goal !== 'any' && r.facets.goal !== this.query.goal) return false;
        if (this.query.diet !== 'none' && r.facets.diet !== this.query.diet) return false;
        if (this.query.method !== 'any') {
          const mm = { 'Air Fryer': 'air-fryer', 'Crockpot': 'crockpot', 'Microwave': 'microwave', 'Frozen SKUs': 'freezer' };
          const mv = mm[this.query.method] || this.query.method;
          if (r.facets.method !== mv && r.facets.method !== this.query.method) return false;
        }
        return true;
      });
    },
    get resultsCount() {
      return this.filteredRecipes.length;
    },
    viewResults() {
      const parts = [];
      const methodMap = { 'Air Fryer': 'air-fryer', 'Crockpot': 'slow-cooker', 'Microwave': 'microwave', 'Frozen SKUs': 'no-cook' };
      if (this.query.goal !== 'any') {
        parts.push('goal/' + this.query.goal);
      }
      if (this.query.diet !== 'none') {
        parts.push('diet/' + this.query.diet);
      }
      if (this.query.method !== 'any') {
        const m = methodMap[this.query.method] || this.query.method.toLowerCase().replace(/ /g, '-');
        parts.push('method/' + m);
      }
      if (parts.length === 0) {
        this.showResults = true;
        this.$nextTick(() => {
          const el = document.getElementById('engine-results');
          if (el) el.scrollIntoView({ behavior: 'smooth' });
        });
      } else {
        window.location.href = '/high-protein/' + parts[0] + '/';
      }
    },
    lockParameters(protein) {
      const el = document.getElementById('decision-engine');
      if (el) el.scrollIntoView({ behavior: 'smooth' });
      if (protein >= 200) this.query.goal = 'muscle-gain';
      else if (protein <= 140) this.query.goal = 'weight-loss';
      else this.query.goal = 'healthy';
    }
  }`}>
    <!-- T1 HERO: MACRO INTENT PILLAR -->
    <section class="relative pt-24 pb-32 px-6 overflow-hidden" style="border-bottom: 1px solid var(--border-default);">
      <div class="max-w-7xl mx-auto relative z-10">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-12">
          <div class="flex-1">
            <div class="flex items-center gap-4 mb-8">
              <span class="px-3 py-1 text-[10px] font-black uppercase tracking-widest rounded"
                    style="background-color: var(--accent-primary); color: var(--text-inverse);">Pillar 02</span>
              <span class="text-[10px] font-black uppercase tracking-[0.4em]" style="color: var(--text-tertiary);">Optimizing Biological Output</span>
            </div>
            <h1 class="text-7xl md:text-9xl font-black tracking-tighter leading-[0.85] mb-8" style="color: var(--text-primary);">
              HIGH<br/><span style="color: var(--text-tertiary);">PROTEIN</span><br/>SYSTEMS
            </h1>
            <p class="max-w-xl text-lg font-medium leading-relaxed" style="color: var(--text-secondary);">
              The definitive data-layer for macro-intent. We map calorie bands, specific diet constraints, and retail availability to high-leverage protein sources.
            </p>
          </div>
          <!-- Macro Calculator Widget -->
          <div class="w-full md:w-96 p-8 rounded-3xl relative overflow-hidden group"
               style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <div class="scanner-line"></div>
            <h3 class="text-xs font-black tracking-widest uppercase mb-6" style="color: var(--text-tertiary);">Target Macro Profile</h3>
            <div class="space-y-6" x-data="{ protein: 180 }">
              <div>
                <div class="flex justify-between text-[10px] font-black uppercase mb-2">
                  <span style="color: var(--text-tertiary);">Daily Protein Goal</span>
                  <span style="color: var(--accent-primary);" x-text="protein + 'G'"></span>
                </div>
                <input type="range" min="100" max="300" x-model="protein" class="w-full h-1 rounded-lg appearance-none cursor-pointer"
                       style="background: var(--bg-tertiary); accent-color: var(--accent-primary);" />
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div class="p-4 rounded-xl" style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
                  <span class="block text-[10px] font-bold uppercase mb-1" style="color: var(--text-tertiary);">Avg Cal</span>
                  <span class="text-xl font-black tabular-nums" style="color: var(--text-primary);">{hpAvgCals.toLocaleString()}</span>
                </div>
                <div class="p-4 rounded-xl" style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
                  <span class="block text-[10px] font-bold uppercase mb-1" style="color: var(--text-tertiary);">Avg Protein</span>
                  <span class="text-xl font-black tabular-nums" style="color: var(--accent-primary);">{hpAvgProtein}g</span>
                </div>
              </div>
              <button x-on:click="lockParameters(protein)" class="theme-btn-primary w-full py-4 text-xs font-black uppercase tracking-widest rounded-xl">Lock Parameters</button>
            </div>
          </div>
        </div>
      </div>
      <div class="absolute top-0 right-0 w-1/3 h-full pointer-events-none" style="background: linear-gradient(to left, var(--accent-glow), transparent);"></div>
      <div class="absolute -bottom-24 -left-24 w-96 h-96 blur-[120px] rounded-full pointer-events-none" style="background: var(--accent-glow);"></div>
    </section>

    <!-- DECISION ENGINE -->
    <section id="decision-engine" class="py-24 px-6 max-w-7xl mx-auto">
      <div class="flex items-center gap-4 mb-12">
        <div class="h-[1px] flex-grow" style="background: var(--border-default);"></div>
        <h2 class="text-[10px] font-black uppercase tracking-[0.5em] whitespace-nowrap" style="color: var(--text-tertiary);">Decision Engine v1.0</h2>
        <div class="h-[1px] flex-grow" style="background: var(--border-default);"></div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch">
        <div class="lg:col-span-9 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="p-8 rounded-3xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="block text-[10px] font-black uppercase tracking-widest mb-6" style="color: var(--text-tertiary);">01. Primary Goal</label>
            <div class="flex flex-wrap gap-2">
              <template x-for="g in ['weight-loss', 'muscle-gain', 'healthy']">
                <button x-on:click="query.goal = query.goal === g ? 'any' : g"
                        x-bind:style="query.goal === g ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all"
                        x-text="g.replace(/-/g, ' ')"></button>
              </template>
            </div>
          </div>
          <div class="p-8 rounded-3xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="block text-[10px] font-black uppercase tracking-widest mb-6" style="color: var(--text-tertiary);">02. Dietary Constraints</label>
            <select x-model="query.diet" class="w-full py-2 text-xl font-bold outline-none transition-all appearance-none cursor-pointer bg-transparent"
                    style="border-bottom: 2px solid var(--border-default); color: var(--text-primary);">
              <option value="none">No Restrictions</option>
              <option value="low-carb">Low Carb</option>
              <option value="keto">Keto</option>
              <option value="vegan">Vegan / Plant-Based</option>
              <option value="gluten-free">Gluten-Free</option>
              <option value="dairy-free">Dairy-Free</option>
            </select>
          </div>
          <div class="p-8 rounded-3xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="block text-[10px] font-black uppercase tracking-widest mb-6" style="color: var(--text-tertiary);">03. Logistics / Method</label>
            <div class="grid grid-cols-2 gap-3">
              <template x-for="m in ['Air Fryer', 'Crockpot', 'Microwave', 'Frozen SKUs']">
                <button x-on:click="query.method = query.method === m ? 'any' : m"
                        x-bind:style="query.method === m ? 'border-color: var(--accent-primary); color: var(--accent-primary); background: var(--accent-glow);' : 'border: 1px solid var(--border-default); color: var(--text-secondary);'"
                        class="p-3 rounded-xl text-[10px] font-bold uppercase text-left flex justify-between items-center group transition-colors">
                  <span x-text="m"></span>
                  <span class="w-1.5 h-1.5 rounded-full" x-bind:style="query.method === m ? 'background: var(--accent-primary);' : 'background: var(--text-tertiary);'"></span>
                </button>
              </template>
            </div>
          </div>
          <div class="p-8 rounded-3xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="block text-[10px] font-black uppercase tracking-widest mb-6" style="color: var(--text-tertiary);">04. Retail Preference</label>
            <div class="flex items-center gap-4">
              <div class="flex -space-x-3">
                {storeBadges.map(badge => (
                  <a href={badge.href} class="w-10 h-10 rounded-full flex items-center justify-center text-[10px] font-bold hover:scale-110 transition-transform"
                       style="background: var(--bg-tertiary); border: 2px solid var(--bg-primary); color: var(--text-primary);">{badge.abbr}</a>
                ))}
              </div>
              <span class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--text-tertiary);">Filter by store inventory</span>
            </div>
          </div>
        </div>
        <div class="lg:col-span-3 rounded-3xl p-8 flex flex-col justify-between items-center text-center"
             style="background-color: var(--accent-primary); color: var(--text-inverse);">
          <div>
            <span class="text-[10px] font-black uppercase tracking-[0.3em] mb-4 block opacity-60">Engine Match</span>
            <div class="text-8xl font-black tracking-tighter tabular-nums" x-text="resultsCount">842</div>
            <span class="font-bold uppercase text-[10px] tracking-widest">Available Strategies</span>
          </div>
          <button x-on:click="viewResults()" class="w-full py-5 rounded-2xl font-black uppercase tracking-widest text-xs hover:scale-[1.02] active:scale-[0.98] transition-all"
                  style="background: var(--text-primary); color: var(--bg-primary);">View Results →</button>
        </div>
      </div>
    </section>

    <!-- INLINE RESULTS (shown when showResults is true) -->
    <section id="engine-results" x-show="showResults" x-cloak class="py-16 px-6 max-w-7xl mx-auto" x-transition>
      <div class="flex items-center gap-4 mb-8">
        <div class="h-[1px] flex-grow" style="background: var(--border-default);"></div>
        <h2 class="text-[10px] font-black uppercase tracking-[0.5em] whitespace-nowrap" style="color: var(--text-tertiary);">
          Filtered Results (<span x-text="filteredRecipes.length"></span>)
        </h2>
        <div class="h-[1px] flex-grow" style="background: var(--border-default);"></div>
      </div>
      <div x-show="filteredRecipes.length === 0" class="text-center py-12">
        <p class="text-lg font-bold" style="color: var(--text-secondary);">No recipes match your current filters. Try adjusting your selections above.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <template x-for="r in filteredRecipes" x-bind:key="r.slug">
          <a x-bind:href="'/high-protein/recipes/' + r.slug + '/'" class="group rounded-2xl overflow-hidden border transition-all hover:shadow-lg hover:-translate-y-1" style="border-color: var(--border-default); background: var(--bg-secondary);">
            <div class="aspect-video overflow-hidden relative">
              <img
                x-bind:src="'/images/recipes/' + r.slug + '.jpg'"
                x-on:error="$el.src='/images/placeholder.svg'"
                x-bind:alt="r.imageAlt"
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                width="400" height="225" loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
              <div class="absolute bottom-3 left-3 flex gap-2">
                <span class="px-2 py-1 rounded text-[9px] font-black uppercase" style="background-color: var(--accent-primary); color: var(--text-inverse);" x-text="r.protein + 'g protein'"></span>
                <span class="px-2 py-1 rounded text-[9px] font-black uppercase" style="background: rgba(0,0,0,0.6); color: white;" x-text="r.calories + ' cal'"></span>
              </div>
            </div>
            <div class="p-4">
              <h3 class="font-black text-sm mb-2 leading-tight group-hover:opacity-80 transition-opacity" x-text="r.title"></h3>
              <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                <span x-text="r.prepTime + 'm total'"></span>
                <span>·</span>
                <span x-text="r.servings + ' servings'"></span>
              </div>
            </div>
          </a>
        </template>
      </div>
      <div class="text-center mt-8">
        <button x-on:click="showResults = false" class="text-xs font-black uppercase tracking-widest" style="color: var(--accent-primary);">
          ← Back to Engine
        </button>
      </div>
    </section>

    <!-- TOP CLUSTERS -->
    <section class="py-24 px-6" style="border-top: 1px solid var(--border-default); background: var(--bg-tertiary);">
      <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-end mb-16">
          <div>
            <h2 class="text-4xl md:text-5xl font-black tracking-tighter mb-4" style="color: var(--text-primary);">AUTHORITY PACKS</h2>
            <p class="font-medium" style="color: var(--text-secondary);">Pre-indexed collections of high-intent high-protein strategies.</p>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Retail Frozen -->
          <a href="/high-protein/store/trader-joes/" class="hyper-border p-8 rounded-[2rem] flex flex-col justify-between min-h-[450px] group overflow-hidden">
            <div class="relative z-10">
              <div class="flex justify-between items-start mb-8">
                <span class="px-2 py-1 text-[9px] font-black uppercase tracking-widest rounded"
                      style="background: var(--bg-tertiary); color: var(--text-primary);">SKU Index</span>
                <span class="text-xs font-black" style="color: var(--accent-primary);">150+ PGS</span>
              </div>
              <h3 class="text-3xl font-black tracking-tighter mb-4 leading-none" style="color: var(--text-primary);">Frozen High-Protein Deep-Dive</h3>
              <p class="text-sm font-medium leading-relaxed" style="color: var(--text-secondary);">Trader Joe's, Costco, and Walmart frozen SKUs sorted by absolute protein-to-calorie efficiency.</p>
            </div>
            <div class="relative z-10 pt-8 mt-8 flex justify-between items-center" style="border-top: 1px solid var(--border-default);">
              <span class="text-[10px] font-black uppercase tracking-widest" style="color: var(--text-tertiary);">Retail Facet</span>
            </div>
          </a>
          <!-- Fast Food -->
          <a href="/high-protein/chain/chick-fil-a/" class="hyper-border p-8 rounded-[2rem] flex flex-col justify-between min-h-[450px] group overflow-hidden"
             style="background: var(--bg-tertiary);">
            <div class="relative z-10">
              <div class="flex justify-between items-start mb-8">
                <span class="px-2 py-1 text-[9px] font-black uppercase tracking-widest rounded"
                      style="background: var(--text-primary); color: var(--bg-primary);">Chain Hacks</span>
                <span class="text-xs font-black" style="color: var(--text-primary);">{fastFoodChainCount} CHAINS</span>
              </div>
              <h3 class="text-3xl font-black tracking-tighter mb-4 leading-none" style="color: var(--text-primary);">Fast Food Macro Modification</h3>
              <p class="text-sm font-medium leading-relaxed" style="color: var(--text-secondary);">How to hack Chick-Fil-A, Chipotle, and Panda Express for 50g+ protein under 600 cals.</p>
            </div>
            <div class="relative z-10 space-y-3 mt-8">
              <div class="flex flex-wrap gap-2">
                {['Chipotle', 'Chick-Fil-A', 'Panera'].map(chain => (
                  <span class="px-2 py-1 rounded text-[9px] font-bold uppercase"
                        style="border: 1px solid var(--border-default); color: var(--text-primary);">{chain}</span>
                ))}
              </div>
              <div class="w-full h-1.5 rounded-full overflow-hidden" style="background: var(--border-default);">
                <div class="w-3/4 h-full" style="background: var(--text-primary);"></div>
              </div>
            </div>
          </a>
          <!-- Clinical -->
          <a href="/high-protein/persona/bariatric/" class="hyper-border p-8 rounded-[2rem] flex flex-col justify-between min-h-[450px] group overflow-hidden"
             style="border-left: 4px solid var(--accent-primary);">
            <div class="relative z-10">
              <div class="flex justify-between items-start mb-8">
                <span class="px-2 py-1 text-[9px] font-black uppercase tracking-widest rounded"
                      style="background: var(--bg-tertiary); color: var(--text-primary);">Trust Tier</span>
                <span class="text-[9px] font-black uppercase tracking-widest" style="color: var(--text-tertiary);">High Retention</span>
              </div>
              <h3 class="text-3xl font-black tracking-tighter mb-4 leading-none" style="color: var(--text-primary);">Biological & Health Targets</h3>
              <p class="text-sm font-medium leading-relaxed" style="color: var(--text-secondary);">Protein-forward protocols for PCOS management, bariatric recovery, and cholesterol control.</p>
            </div>
            <div class="relative z-10 mt-8 grid grid-cols-2 gap-4">
              <div class="text-center p-3 rounded-xl" style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
                <span class="block text-xl font-black" style="color: var(--text-primary);">{hpRecipeCount}</span>
                <span class="text-[8px] uppercase font-bold" style="color: var(--text-tertiary);">Recipes</span>
              </div>
              <div class="text-center p-3 rounded-xl" style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
                <span class="block text-xl font-black" style="color: var(--text-primary);">{planCount}</span>
                <span class="text-[8px] uppercase font-bold" style="color: var(--text-tertiary);">Meal Plans</span>
              </div>
            </div>
          </a>
        </div>
      </div>
    </section>

    <!-- FEATURED HIGH PROTEIN RECIPES -->
    <section class="py-24 px-6 max-w-7xl mx-auto">
      <div class="flex items-center gap-4 mb-12">
        <div class="h-[1px] flex-grow" style="background: var(--border-default);"></div>
        <h2 class="text-[10px] font-black uppercase tracking-[0.5em] whitespace-nowrap" style="color: var(--text-tertiary);">Featured High Protein Recipes</h2>
        <div class="h-[1px] flex-grow" style="background: var(--border-default);"></div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {highProteinRecipes.map(r => (
          <a href={`/high-protein/recipes/${r.slug}/`} class="group rounded-2xl overflow-hidden border transition-all hover:shadow-lg hover:-translate-y-1" style="border-color: var(--border-default); background: var(--bg-secondary);">
            <div class="aspect-video overflow-hidden relative">
              <img
                src={`/images/recipes/${r.slug}.jpg`}
                onerror={`this.onerror=null;this.src='${fallbackImage}'`}
                alt={r.imageAlt || r.title}
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                width="400"
                height="225"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
              <div class="absolute bottom-3 left-3 flex gap-2">
                <span class="px-2 py-1 rounded text-[9px] font-black uppercase" style="background-color: var(--accent-primary); color: var(--text-inverse);">{r.protein}g protein</span>
                <span class="px-2 py-1 rounded text-[9px] font-black uppercase" style="background: rgba(0,0,0,0.6); color: white;">{r.calories} cal</span>
              </div>
            </div>
            <div class="p-4">
              <h3 class="font-black text-sm mb-2 leading-tight group-hover:opacity-80 transition-opacity">{r.title}</h3>
              <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                <span>{r.prepTime + r.cookTime}m total</span>
                <span>·</span>
                <span>{r.servings} servings</span>
              </div>
            </div>
          </a>
        ))}
      </div>
    </section>

    <!-- FACET MEGA-NAV -->
    <FacetNav layout="columns" sectionTitle="Global Taxonomy Explorer" groups={facetGroups} />

    <!-- EXPLORE BY BLOCKS — Internal link density for T1 hub -->
    <ExploreByBlock headline="EXPLORE ALL CATEGORIES" subtitle="Full Taxonomy Navigation" columns={exploreColumns} variant="light" />

    <!-- 5-DAY PROTOCOL -->
    <section class="py-24 overflow-hidden relative" style="background-color: var(--accent-primary); color: var(--text-inverse);">
      <div class="px-6 max-w-7xl mx-auto flex flex-col md:flex-row gap-16 items-center">
        <div class="flex-1 relative z-10">
          <div class="flex items-center gap-2 mb-6">
            <div class="w-10 h-[2px]" style="background: var(--text-inverse);"></div>
            <span class="text-[10px] font-black uppercase tracking-widest">The High Protein Standard</span>
          </div>
          <h2 class="text-6xl md:text-8xl font-black tracking-tighter leading-[0.85] mb-8 uppercase">THE 200G<br/>PROTOCOL</h2>
          <p class="text-xl font-medium mb-12 opacity-80 max-w-lg">
            The ultimate execution plan. 5 days, 200g protein daily, under 2400 calories. Sunday prep: 105 mins.
          </p>
          <div class="flex flex-wrap gap-4">
            <a href="/high-protein/plans/high-protein-muscle-gain-5-day/" class="px-10 py-5 text-xs font-black uppercase tracking-widest rounded-full hover:scale-105 transition-transform inline-block"
                    style="background: var(--text-primary); color: var(--bg-primary);">Download Plan (PDF)</a>
            <a href="/high-protein/plans/keto-weight-loss-5-day/" class="px-10 py-5 text-xs font-black uppercase tracking-widest rounded-full transition-all inline-block"
                    style="border: 2px solid var(--text-inverse);">View Keto Plan</a>
          </div>
        </div>
        <div class="flex-1 relative">
          <div class="p-10 rounded-3xl rotate-2"
               style="background: var(--bg-secondary); border: 2px solid var(--text-primary); box-shadow: 20px 20px 0px 0px var(--text-primary);">
            <div class="flex justify-between items-center mb-10 pb-4" style="border-bottom: 1px solid var(--border-default);">
              <span class="text-xs font-black tracking-widest" style="color: var(--text-primary);">EXECUTION STEPS</span>
              <span class="px-2 py-1 text-[9px] font-black uppercase" style="background: var(--text-primary); color: var(--bg-primary);">LIVE v2.4</span>
            </div>
            <div class="space-y-6">
              {[
                { step: '01', text: 'Batch cook 5lbs Lean Protein (Turkey/Chicken) with signature spice blend.' },
                { step: '02', text: 'Partition 1.5 cups roasted cruciferous vegetables across 10 glass containers.' },
                { step: '03', text: 'Apply calorie-dense sauces (substitute for Greek Yogurt base).', strikethrough: true },
              ].map(item => (
                <div class="flex items-start gap-4">
                  <span class="w-6 h-6 rounded-full text-[10px] flex items-center justify-center flex-shrink-0 font-black"
                        style="background: var(--text-primary); color: var(--bg-primary);">{item.step}</span>
                  <p class="text-sm font-bold leading-tight"
                     style={item.strikethrough ? 'color: var(--text-tertiary); text-decoration: line-through;' : `color: var(--text-primary);`}>{item.text}</p>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <FooterNav site="proteinmeals" />
</BaseLayout>
