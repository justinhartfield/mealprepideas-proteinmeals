---
/**
 * HighProteinHub — High Protein Hub Page (Wizard + Filterable Browser)
 * This is the /high-protein/ hub — distinct from the homepage.
 * Features: Wizard tool, filterable recipe/plan grid, taxonomy navigation
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import FacetNav from './FacetNav.astro';
import { recipes } from '../data/content/recipes';
import { plans } from '../data/content/plans';
import {
  getHighProteinRecipeCount,
  getHighProteinAverageProtein,
  getHighProteinAverageCalories,
  getPlanCount,
  getFastFoodChains,
} from '../utils/stats';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const allHPRecipes = recipes.filter(r => r.hub === 'high-protein');
const allHPPlans = plans.filter(p => p.hub === 'high-protein');
const fallbackImage = '/images/placeholder.svg';

// Dynamic stats
const hpRecipeCount = getHighProteinRecipeCount();
const hpAvgProtein = getHighProteinAverageProtein();
const hpAvgCals = getHighProteinAverageCalories();
const planCount = getPlanCount();

// Serialize data for Alpine.js
const alpineRecipeData = JSON.stringify(
  allHPRecipes.map(r => ({
    slug: r.slug,
    title: r.title,
    protein: r.protein,
    calories: r.calories,
    imageAlt: r.imageAlt || r.title,
    prepTime: r.prepTime + r.cookTime,
    servings: r.servings,
    meal: r.facets.meal || '',
    method: r.facets.method || '',
    diet: r.facets.diet || '',
    goal: r.facets.goal || '',
    constraint: r.facets.constraint || '',
  }))
);

const alpinePlanData = JSON.stringify(
  allHPPlans.map(p => ({
    slug: p.slug,
    title: p.title,
    description: p.description,
    dailyProtein: p.dailyProtein,
    dailyCalories: p.dailyCalories,
    groceryBudget: p.groceryBudget,
    totalMeals: p.days.reduce((sum, d) => sum + d.meals.length, 0),
  }))
);

// Extract unique filter values
const uniqueMeals = [...new Set(allHPRecipes.map(r => r.facets.meal).filter(Boolean))];
const uniqueMethods = [...new Set(allHPRecipes.map(r => r.facets.method).filter(Boolean))];
const uniqueDiets = [...new Set(allHPRecipes.map(r => r.facets.diet).filter(Boolean))];
const uniqueGoals = [...new Set(allHPRecipes.map(r => r.facets.goal).filter(Boolean))];

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
}

const { title, description, canonicalUrl } = Astro.props;

// Facet groups for taxonomy nav
const facetGroups = [
  { title: 'By Diet', titleHref: '/high-protein/diet/', items: [
    { label: 'High Protein Vegan', href: '/high-protein/diet/vegan/' },
    { label: 'Vegetarian Protein', href: '/high-protein/diet/vegetarian/' },
    { label: 'Keto Protein Meals', href: '/high-protein/diet/keto/' },
    { label: 'Low Carb Protein', href: '/high-protein/diet/low-carb/' },
    { label: 'Low Calorie Bands', href: '/high-protein/diet/low-calorie/' },
    { label: 'Gluten-Free Macros', href: '/high-protein/diet/gluten-free/' },
    { label: 'Dairy-Free Muscle', href: '/high-protein/diet/dairy-free/' },
  ] },
  { title: 'By Method', titleHref: '/high-protein/method/', items: [
    { label: 'Air Fryer Protein', href: '/high-protein/method/air-fryer/' },
    { label: 'Slow Cooker Batch', href: '/high-protein/method/slow-cooker/' },
    { label: 'Crockpot Protein', href: '/high-protein/method/crockpot/' },
    { label: 'Instant Pot High-Pro', href: '/high-protein/method/instant-pot/' },
    { label: 'Microwave Survival', href: '/high-protein/method/microwave/' },
    { label: 'Sheet Pan Protein', href: '/high-protein/method/sheet-pan/' },
    { label: 'One Pan Meals', href: '/high-protein/method/one-pan/' },
    { label: 'No-Cook Macros', href: '/high-protein/method/no-cook/' },
    { label: 'Freezer Protein', href: '/high-protein/method/freezer/' },
    { label: 'Grill Protein', href: '/high-protein/method/grill/' },
    { label: 'Oven Protein', href: '/high-protein/method/oven/' },
  ] },
  { title: 'By Constraint', titleHref: '/high-protein/constraint/', items: [
    { label: 'High Fiber Protein', href: '/high-protein/constraint/high-fiber/' },
    { label: 'Low Sodium Choices', href: '/high-protein/constraint/low-sodium/' },
    { label: 'Low Fat Protein', href: '/high-protein/constraint/low-fat/' },
    { label: 'Budget Protein Prep', href: '/high-protein/constraint/budget/' },
    { label: 'Cheap Protein', href: '/high-protein/constraint/cheap/' },
    { label: 'Quick Protein', href: '/high-protein/constraint/quick/' },
    { label: 'Simple Protein', href: '/high-protein/constraint/simple/' },
    { label: 'For The Week', href: '/high-protein/constraint/for-the-week/' },
    { label: 'No-Microwave Lunch', href: '/high-protein/constraint/no-microwave/' },
  ] },
  { title: 'By Persona', titleHref: '/high-protein/persona/', items: [
    { label: 'Office Lunch Prep', href: '/high-protein/persona/work/' },
    { label: 'College Student Gains', href: '/high-protein/persona/college/' },
    { label: 'Picky Eater Hacks', href: '/high-protein/persona/picky-eaters/' },
    { label: 'Kids Protein', href: '/high-protein/persona/kids/' },
    { label: 'Toddler Protein', href: '/high-protein/persona/toddler/' },
    { label: 'Pregnancy Protein', href: '/high-protein/persona/pregnancy/' },
    { label: 'Postpartum Recovery', href: '/high-protein/persona/postpartum/' },
    { label: 'Bariatric Support', href: '/high-protein/persona/bariatric/' },
    { label: 'PCOS Protein', href: '/high-protein/persona/pcos/' },
    { label: 'Cholesterol Protein', href: '/high-protein/persona/cholesterol/' },
  ] },
  { title: 'By Ingredient', titleHref: '/high-protein/ingredient/', items: [
    { label: 'Chicken Breast Prep', href: '/high-protein/ingredient/chicken/' },
    { label: 'Ground Beef Protein', href: '/high-protein/ingredient/ground-beef/' },
    { label: 'Ground Turkey Ideas', href: '/high-protein/ingredient/ground-turkey/' },
    { label: 'Wild Salmon Prep', href: '/high-protein/ingredient/salmon/' },
    { label: 'Shrimp Meals', href: '/high-protein/ingredient/shrimp/' },
    { label: 'Lean Steak Meals', href: '/high-protein/ingredient/steak/' },
    { label: 'Salad Protein', href: '/high-protein/ingredient/salad/' },
  ] },
  { title: 'Popular Stores', titleHref: '/high-protein/store/', items: [
    { label: "Trader Joe's", href: '/high-protein/store/trader-joes/' },
    { label: 'Costco', href: '/high-protein/store/costco/' },
    { label: 'Walmart', href: '/high-protein/store/walmart/' },
    { label: 'Aldi', href: '/high-protein/store/aldi/' },
    { label: 'Whole Foods', href: '/high-protein/store/whole-foods/' },
    { label: 'Kroger', href: '/high-protein/store/kroger/' },
    { label: 'Target', href: '/high-protein/store/target/' },
    { label: 'Sprouts', href: '/high-protein/store/sprouts/' },
  ] },
  { title: 'Popular Chains', titleHref: '/high-protein/chain/', items: [
    { label: 'Chick-fil-A', href: '/high-protein/chain/chick-fil-a/' },
    { label: "McDonald's", href: '/high-protein/chain/mcdonalds/' },
    { label: 'Chipotle', href: '/high-protein/chain/chipotle/' },
    { label: 'Panera', href: '/high-protein/chain/panera/' },
    { label: 'Subway', href: '/high-protein/chain/subway/' },
    { label: 'Sweetgreen', href: '/high-protein/chain/sweetgreen/' },
    { label: 'CAVA', href: '/high-protein/chain/cava/' },
    { label: 'Five Guys', href: '/high-protein/chain/five-guys/' },
  ] },
];

const exploreColumns = [
  {
    title: 'By Meal',
    titleHref: '/high-protein/meal/',
    links: [
      { label: 'Breakfast Protein', href: '/high-protein/meal/breakfast/' },
      { label: 'Lunch Protein', href: '/high-protein/meal/lunch/' },
      { label: 'Dinner Protein', href: '/high-protein/meal/dinner/' },
      { label: 'Protein Snacks', href: '/high-protein/meal/snacks/' },
    ],
  },
  {
    title: 'By Goal',
    titleHref: '/high-protein/goal/',
    links: [
      { label: 'Weight Loss Protein', href: '/high-protein/goal/weight-loss/' },
      { label: 'Muscle Gain Protein', href: '/high-protein/goal/muscle-gain/' },
      { label: 'Healthy Protein', href: '/high-protein/goal/healthy/' },
    ],
  },
  {
    title: 'By Diet',
    titleHref: '/high-protein/diet/',
    links: [
      { label: 'Vegan Protein', href: '/high-protein/diet/vegan/' },
      { label: 'Keto Protein', href: '/high-protein/diet/keto/' },
      { label: 'Low Carb Protein', href: '/high-protein/diet/low-carb/' },
      { label: 'Low Calorie', href: '/high-protein/diet/low-calorie/' },
      { label: 'Gluten Free', href: '/high-protein/diet/gluten-free/' },
      { label: 'Dairy Free', href: '/high-protein/diet/dairy-free/' },
      { label: 'Vegetarian', href: '/high-protein/diet/vegetarian/' },
    ],
  },
  {
    title: 'By Constraint',
    titleHref: '/high-protein/constraint/',
    links: [
      { label: 'Budget Protein', href: '/high-protein/constraint/budget/' },
      { label: 'Quick Protein', href: '/high-protein/constraint/quick/' },
      { label: 'High Fiber', href: '/high-protein/constraint/high-fiber/' },
      { label: 'Low Sodium', href: '/high-protein/constraint/low-sodium/' },
      { label: 'Simple Protein', href: '/high-protein/constraint/simple/' },
      { label: 'For The Week', href: '/high-protein/constraint/for-the-week/' },
      { label: 'No Microwave', href: '/high-protein/constraint/no-microwave/' },
    ],
  },
];

const structuredData = JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'High Protein Hub',
  description: 'Browse all high protein recipes, macro-optimized plans, and discover your perfect protein strategy with our interactive wizard.',
  url: 'https://proteinmeals.co/high-protein/',
});

// i18n
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl} structuredData={structuredData}>
  <HeaderNav
    site="proteinmeals"
    activeLink="/high-protein/"
    statusText="LIVE FEED:"
    statusBadge="NEW TRADER JOE'S SKUS DETECTED"
  />

  <main class="flex-grow">
    <!-- ════════════════════════════════════════════════════════════════
         SECTION A: WIZARD TOOL — "BUILD YOUR MACRO PROTOCOL"
         ════════════════════════════════════════════════════════════════ -->
    <section class="relative py-20 px-6 overflow-hidden" style="background: var(--bg-primary); border-bottom: 1px solid var(--border-default);"
             x-data="{
               goal: '',
               method: '',
               diet: '',
               meal: '',
               constraint: '',
               generatePlan() {
                 // Two-facet combos that exist for high-protein: method+goal, diet+constraint, store+constraint, chain+goal
                 if (!this.goal && !this.method && !this.diet && !this.meal && !this.constraint) {
                   document.getElementById('recipe-browser')?.scrollIntoView({ behavior: 'smooth' });
                   return;
                 }
                 // Try two-facet combos first (matching indexed combos)
                 if (this.method && this.goal) {
                   window.location.href = '/high-protein/method/' + this.method + '/goal/' + this.goal + '/';
                   return;
                 }
                 if (this.diet && this.constraint) {
                   window.location.href = '/high-protein/diet/' + this.diet + '/constraint/' + this.constraint + '/';
                   return;
                 }
                 // Fallback: canonical order single-facet
                 if (this.meal) { window.location.href = '/high-protein/meal/' + this.meal + '/'; return; }
                 if (this.method) { window.location.href = '/high-protein/method/' + this.method + '/'; return; }
                 if (this.diet) { window.location.href = '/high-protein/diet/' + this.diet + '/'; return; }
                 if (this.goal) { window.location.href = '/high-protein/goal/' + this.goal + '/'; return; }
                 if (this.constraint) { window.location.href = '/high-protein/constraint/' + this.constraint + '/'; return; }
               },
               resetWizard() {
                 this.goal = '';
                 this.method = '';
                 this.diet = '';
                 this.meal = '';
                 this.constraint = '';
               }
             }">
      <!-- Gradient accents -->
      <div class="absolute top-0 right-0 w-1/3 h-full pointer-events-none" style="background: linear-gradient(to left, var(--accent-glow), transparent);"></div>
      <div class="absolute -bottom-24 -left-24 w-96 h-96 blur-[120px] rounded-full pointer-events-none" style="background: var(--accent-glow);"></div>

      <div class="max-w-7xl mx-auto relative z-10">
        <!-- Header -->
        <div class="flex flex-col md:flex-row items-start md:items-end justify-between gap-8 mb-12">
          <div>
            <div class="flex items-center gap-3 mb-6">
              <span class="px-3 py-1 text-[10px] font-black uppercase tracking-widest rounded"
                    style="background-color: var(--accent-primary); color: var(--text-inverse);">Protein Hub</span>
              <span class="text-[10px] font-black uppercase tracking-[0.4em]" style="color: var(--text-tertiary);">{t('hub.interactiveWizard')}</span>
            </div>
            <h1 class="text-5xl md:text-7xl font-black tracking-tighter leading-[0.85] mb-4" style="color: var(--text-primary);">
              BUILD YOUR<br/>MACRO PROTOCOL
            </h1>
            <p class="max-w-lg text-lg font-medium" style="color: var(--text-secondary);">
              Select your constraints and we'll generate the optimal high-protein strategy. Pick as many or as few as you want.
            </p>
          </div>
          <div class="flex gap-6">
            <div class="text-center">
              <span class="text-[40px] font-black tabular-nums tracking-tighter block leading-none" style="color: var(--accent-primary);">{hpAvgProtein}g</span>
              <span class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--text-secondary);">{t('hub.avgProtein')}</span>
            </div>
            <div class="text-center">
              <span class="text-[40px] font-black tabular-nums tracking-tighter block leading-none" style="color: var(--text-primary);">{hpRecipeCount}</span>
              <span class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--text-secondary);">{t('hub.recipes')}</span>
            </div>
          </div>
        </div>

        <!-- Wizard Steps -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
          <!-- 01. Goal -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.goal')}</label>
            <div class="space-y-2">
              <template x-for="g in [{v:'weight-loss',l:'Weight Loss'},{v:'muscle-gain',l:'Muscle Gain'},{v:'healthy',l:'Healthy'}]">
                <button x-on:click="goal = goal === g.v ? '' : g.v"
                        x-bind:style="goal === g.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="g.l"></button>
              </template>
            </div>
          </div>

          <!-- 02. Method -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.method')}</label>
            <div class="space-y-2">
              <template x-for="m in [{v:'crockpot',l:'Crockpot'},{v:'air-fryer',l:'Air Fryer'},{v:'microwave',l:'Microwave'},{v:'no-cook',l:'No-Cook'},{v:'freezer',l:'Freezer'},{v:'instant-pot',l:'Instant Pot'}]">
                <button x-on:click="method = method === m.v ? '' : m.v"
                        x-bind:style="method === m.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="m.l"></button>
              </template>
            </div>
          </div>

          <!-- 03. Diet -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.diet')}</label>
            <div class="space-y-2">
              <template x-for="d in [{v:'vegan',l:'Vegan'},{v:'keto',l:'Keto'},{v:'low-carb',l:'Low-Carb'},{v:'gluten-free',l:'Gluten-Free'},{v:'dairy-free',l:'Dairy-Free'},{v:'vegetarian',l:'Vegetarian'}]">
                <button x-on:click="diet = diet === d.v ? '' : d.v"
                        x-bind:style="diet === d.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="d.l"></button>
              </template>
            </div>
          </div>

          <!-- 04. Meal -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.meal')}</label>
            <div class="space-y-2">
              <template x-for="m in [{v:'breakfast',l:'Breakfast'},{v:'lunch',l:'Lunch'},{v:'dinner',l:'Dinner'},{v:'snacks',l:'Snacks'}]">
                <button x-on:click="meal = meal === m.v ? '' : m.v"
                        x-bind:style="meal === m.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="m.l"></button>
              </template>
            </div>
          </div>

          <!-- 05. Constraint -->
          <div class="p-6 rounded-2xl transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
            <label class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('wizard.constraint')}</label>
            <div class="space-y-2">
              <template x-for="c in [{v:'budget',l:'Budget'},{v:'quick',l:'Quick'},{v:'high-fiber',l:'High-Fiber'},{v:'no-microwave',l:'No-Microwave'},{v:'simple',l:'Simple'}]">
                <button x-on:click="constraint = constraint === c.v ? '' : c.v"
                        x-bind:style="constraint === c.v ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                        class="w-full px-3 py-2 border rounded-lg text-[11px] font-bold uppercase transition-all text-left"
                        x-text="c.l"></button>
              </template>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4">
          <button x-on:click="generatePlan()"
                  class="theme-btn-cta px-10 py-5 rounded-xl font-black uppercase text-sm tracking-widest transition-transform hover:scale-[1.02] flex items-center justify-center gap-3 cursor-pointer">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            {t('hub.generateProtocol')}
          </button>
          <button x-on:click="resetWizard()"
                  class="px-8 py-5 rounded-xl font-black uppercase text-xs tracking-widest transition-all cursor-pointer"
                  style="border: 1px solid var(--border-default); color: var(--text-secondary);">
            {t('hub.resetAll')}
          </button>
        </div>
      </div>
    </section>


    <!-- ════════════════════════════════════════════════════════════════
         SECTION B: FILTERABLE RECIPE & PLAN BROWSER
         ════════════════════════════════════════════════════════════════ -->
    <section id="recipe-browser" class="py-20 px-6"
             style="background: var(--bg-secondary); border-bottom: 1px solid var(--border-default);"
             x-data={`{
               filter: 'all',
               allRecipes: ${alpineRecipeData},
               allPlans: ${alpinePlanData},
               get filteredRecipes() {
                 if (this.filter === 'all') return this.allRecipes;
                 return this.allRecipes.filter(r => {
                   return r.meal === this.filter || r.method === this.filter || r.diet === this.filter || r.goal === this.filter;
                 });
               }
             }`}>
      <div class="max-w-7xl mx-auto">
        <!-- Section Header -->
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 mb-10">
          <div>
            <div class="flex items-center gap-4 mb-3">
              <div class="h-[2px] w-12" style="background-color: var(--accent-primary);"></div>
              <span class="text-[10px] font-black tracking-[0.5em] uppercase" style="color: var(--accent-primary);">{t('hub.browseFilter')}</span>
            </div>
            <h2 class="text-4xl font-black tracking-tighter" style="color: var(--text-primary);">{t('hub.allHPRecipes')}</h2>
          </div>
          <div class="text-sm font-bold" style="color: var(--text-secondary);">
            Showing <span class="font-black" style="color: var(--accent-primary);" x-text="filteredRecipes.length"></span> {t('hub.recipesLc')}
          </div>
        </div>

        <!-- Filter Pills -->
        <div class="flex flex-wrap gap-2 mb-10">
          <button x-on:click="filter = 'all'"
                  x-bind:style="filter === 'all' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'"
                  class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">All</button>
          {uniqueMeals.map(m => (
            <button x-on:click={`filter = filter === '${m}' ? 'all' : '${m}'`}
                    x-bind:style={`filter === '${m}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{m}</button>
          ))}
          {uniqueMethods.map(m => (
            <button x-on:click={`filter = filter === '${m}' ? 'all' : '${m}'`}
                    x-bind:style={`filter === '${m}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{m.replace(/-/g, ' ')}</button>
          ))}
          {uniqueDiets.map(d => (
            <button x-on:click={`filter = filter === '${d}' ? 'all' : '${d}'`}
                    x-bind:style={`filter === '${d}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{d.replace(/-/g, ' ')}</button>
          ))}
          {uniqueGoals.map(g => (
            <button x-on:click={`filter = filter === '${g}' ? 'all' : '${g}'`}
                    x-bind:style={`filter === '${g}' ? 'background: var(--accent-primary); color: var(--text-inverse); border-color: var(--accent-primary);' : 'color: var(--text-secondary); border-color: var(--border-default);'`}
                    class="px-4 py-2 border rounded-full text-[11px] font-bold uppercase transition-all cursor-pointer">{g.replace(/-/g, ' ')}</button>
          ))}
        </div>

        <!-- Recipe Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <template x-for="r in filteredRecipes" x-bind:key="r.slug">
            <a x-bind:href="'/high-protein/recipes/' + r.slug + '/'"
               class="group rounded-2xl overflow-hidden transition-all hover:shadow-lg hover:-translate-y-1"
               style="border: 1px solid var(--border-default); background: var(--bg-primary);">
              <div class="aspect-video overflow-hidden relative">
                <img x-bind:src="'/images/recipes/' + r.slug + '.jpg'"
                     x-on:error="$el.src='/images/placeholder.svg'"
                     x-bind:alt="r.imageAlt"
                     class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                     width="400" height="225" loading="lazy" />
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                <div class="absolute bottom-3 left-3 flex gap-2">
                  <span class="px-2 py-1 rounded text-[9px] font-black uppercase"
                        style="background-color: var(--accent-primary); color: var(--text-inverse);"
                        x-text="r.protein + 'g protein'"></span>
                  <span class="px-2 py-1 rounded text-[9px] font-black uppercase"
                        style="background: rgba(0,0,0,0.6); color: white;"
                        x-text="r.calories + ' cal'"></span>
                </div>
              </div>
              <div class="p-4">
                <h3 class="font-black text-sm mb-2 leading-tight group-hover:opacity-80 transition-opacity" style="color: var(--text-primary);" x-text="r.title"></h3>
                <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                  <span x-text="r.prepTime + 'm total'"></span>
                  <span>·</span>
                  <span x-text="r.servings + ' servings'"></span>
                </div>
              </div>
            </a>
          </template>
        </div>

        <!-- Empty State -->
        <div x-show="filteredRecipes.length === 0" class="text-center py-16 rounded-2xl" style="background: var(--bg-primary); border: 1px solid var(--border-default);">
          <p class="text-lg font-bold mb-2" style="color: var(--text-secondary);">{t('hub.noRecipesMatch')}</p>
          <button x-on:click="filter = 'all'" class="text-xs font-black uppercase tracking-widest cursor-pointer" style="color: var(--accent-primary);">{t('hub.showAllRecipes')}</button>
        </div>

        <!-- PLANS SECTION -->
        <div class="mt-20">
          <div class="flex items-center gap-4 mb-10">
            <div class="h-[2px] w-12" style="background-color: var(--accent-primary);"></div>
            <span class="text-[10px] font-black tracking-[0.5em] uppercase" style="color: var(--accent-primary);">{t('hub.macroOptPlans')}</span>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="p in allPlans" x-bind:key="p.slug">
              <a x-bind:href="'/high-protein/plans/' + p.slug + '/'"
                 class="group rounded-2xl p-8 transition-all hover:shadow-lg hover:-translate-y-1 flex flex-col justify-between"
                 style="border: 1px solid var(--border-default); background: var(--bg-primary);">
                <div>
                  <div class="flex items-center gap-2 mb-4">
                    <span class="px-2 py-1 rounded text-[9px] font-black uppercase"
                          style="background: var(--accent-glow); color: var(--accent-primary); border: 1px solid var(--accent-primary);">5-Day Plan</span>
                  </div>
                  <h3 class="font-black text-xl tracking-tight mb-3 leading-tight group-hover:opacity-80 transition-opacity" style="color: var(--text-primary);" x-text="p.title"></h3>
                  <p class="text-sm font-medium mb-6 line-clamp-2" style="color: var(--text-secondary);" x-text="p.description"></p>
                </div>
                <div class="grid grid-cols-3 gap-3">
                  <div class="text-center p-3 rounded-xl" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                    <span class="block text-lg font-black tabular-nums" style="color: var(--text-primary);" x-text="p.totalMeals"></span>
                    <span class="text-[8px] font-bold uppercase" style="color: var(--text-tertiary);">{t('hub.meals')}</span>
                  </div>
                  <div class="text-center p-3 rounded-xl" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                    <span class="block text-lg font-black tabular-nums" style="color: var(--accent-primary);" x-text="p.dailyProtein + 'g'"></span>
                    <span class="text-[8px] font-bold uppercase" style="color: var(--text-tertiary);">{t('hub.proteinDay')}</span>
                  </div>
                  <div class="text-center p-3 rounded-xl" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                    <span class="block text-lg font-black tabular-nums" style="color: var(--text-primary);" x-text="p.groceryBudget"></span>
                    <span class="text-[8px] font-bold uppercase" style="color: var(--text-tertiary);">{t('hub.budget')}</span>
                  </div>
                </div>
              </a>
            </template>
          </div>
        </div>
      </div>
    </section>


    <!-- ════════════════════════════════════════════════════════════════
         SECTION C: TAXONOMY NAVIGATION (preserved from Phase 8)
         ════════════════════════════════════════════════════════════════ -->
    <FacetNav layout="columns" sectionTitle="Global Taxonomy Explorer" groups={facetGroups} />

    <!-- DATA STREAM -->
    <section class="py-12 relative" style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-default);">
      <div class="data-stream overflow-hidden whitespace-nowrap flex py-2" style="border-top: 1px solid var(--accent-glow); border-bottom: 1px solid var(--accent-glow);">
        <div class="flex animate-marquee gap-8 items-center">
          {[1,2,3,4,5].map(() => (
            <div class="flex gap-8 items-center">
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--accent-primary);">HIGH PROTEIN HUB</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--text-tertiary);">{hpRecipeCount} RECIPES</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--accent-primary);">{hpAvgProtein}g AVG PROTEIN</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
              <span class="text-[10px] font-black tracking-tighter" style="color: var(--text-tertiary);">{hpAvgCals} AVG CALORIES</span>
              <span class="w-1 h-1 rounded-full" style="background: var(--border-default);"></span>
            </div>
          ))}
        </div>
      </div>
    </section>
  </main>

  <FooterNav site="proteinmeals" />
</BaseLayout>
