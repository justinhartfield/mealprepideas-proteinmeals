---
/**
 * GlobalDiscoveryLanding — Homepage / Entry Portal
 * Theme-aware: uses CSS custom properties for light/dark support
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import HeaderNav from './HeaderNav.astro';
import FooterNav from './FooterNav.astro';
import FacetNav from './FacetNav.astro';
import { recipes } from '../data/content/recipes';
import { plans } from '../data/content/plans';
import { stores } from '../data/content/stores';
import {
  getTotalStrategies,
  getAverageProtein,
  getFastFoodChains,
  getRecipeCount,
  getPlanCount,
  getFirstPlanShoppingList,
} from '../utils/stats';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const featuredMealPrep = recipes.filter(r => r.hub === 'meal-prep').slice(0, 3);
const featuredProtein = recipes.filter(r => r.hub === 'high-protein').slice(0, 3);
const fallbackImg = '/images/placeholder.svg';

// Dynamic stats
const totalStrategies = getTotalStrategies();
const avgProtein = getAverageProtein();
const recipeCount = getRecipeCount();
const planCount = getPlanCount();

// Dynamic chain data from stores
const fastFoodChains = getFastFoodChains().slice(0, 4);
const chainNames = fastFoodChains.map(c => c.name.toUpperCase());

// Real shopping list from first plan
const shoppingListItems = getFirstPlanShoppingList();

// Store abbreviation badges with links
const storeBadges = [
  { abbr: 'TJ', slug: 'trader-joes' },
  { abbr: 'CO', slug: 'costco' },
  { abbr: 'WM', slug: 'walmart' },
];

interface Props {
  title: string;
  description?: string;
  site?: "mealprepideas" | "proteinmeals";
}

const { title, description, site = 'mealprepideas' } = Astro.props;

// Cross-site URL helpers: links to the other site's hub use absolute URLs
const mpBase = site === 'mealprepideas' ? '' : 'https://mealprepideas.co';
const hpBase = site === 'proteinmeals' ? '' : 'https://proteinmeals.co';

const facetChips = [
  { label: 'Crockpot', href: `${mpBase}/meal-prep/method/crockpot/` },
  { label: 'Slow-Cooker', href: `${mpBase}/meal-prep/method/slow-cooker/` },
  { label: 'Trader Joes', href: '/stores/trader-joes/' },
  { label: 'Costco', href: '/stores/costco/' },
  { label: 'Weight-Loss', href: `${hpBase}/high-protein/goal/weight-loss/` },
  { label: 'Postpartum', href: `${mpBase}/meal-prep/persona/postpartum/` },
  { label: 'High Fiber', href: `${hpBase}/high-protein/constraint/high-fiber/` },
  { label: 'Budget', href: `${mpBase}/meal-prep/constraint/budget/` },
  { label: 'Chicken', href: `${mpBase}/meal-prep/ingredient/chicken/` },
  { label: 'Salmon', href: `${hpBase}/high-protein/ingredient/salmon/` },
  { label: 'Low-Sodium', href: `${hpBase}/high-protein/constraint/low-sodium/` },
  { label: 'Air-Fryer', href: `${mpBase}/meal-prep/method/air-fryer/` },
  { label: 'Walmart', href: '/stores/walmart/' },
  { label: 'Chick-Fil-A', href: '/stores/chick-fil-a/' },
  { label: 'Bariatric', href: `${hpBase}/high-protein/persona/bariatric/` },
  { label: 'College', href: `${mpBase}/meal-prep/persona/college/` },
];

// i18n
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<BaseLayout title={title} description={description}>
  <HeaderNav />

  <main class="flex-grow" x-data="{ activeHub: 'all', openFilter: false }">
    <!-- HERO: GATEWAY MODULE -->
    <section class="relative min-h-[70vh] flex flex-col md:flex-row overflow-hidden"
             style="border-bottom: 1px solid var(--border-default);">
      <!-- PORTAL 1: MEAL PREP -->
      <a href={`${mpBase}/meal-prep/`}
         x-on:mouseenter="activeHub = 'meal-prep'"
         x-on:mouseleave="activeHub = 'all'"
         class="relative flex-1 group transition-all duration-700 ease-out flex flex-col justify-end p-12 overflow-hidden"
         style="border-right: 1px solid var(--border-default);"
         x-bind:class="activeHub === 'high-protein' ? 'opacity-30' : 'opacity-100'">
        <div class="absolute inset-0 transition-colors" style="background-color: var(--bg-secondary);"></div>
        <img src="/images/hero-meal-prep.jpg" onerror="this.onerror=null;this.src='/images/placeholder.svg'"
             class="absolute inset-0 w-full h-full object-cover opacity-30 group-hover:opacity-50 transition-opacity duration-700" alt="Meal Prep" width="1200" height="675" />
        <div class="relative z-10">
          <span class="text-xs font-bold tracking-[0.5em] block mb-4" style="color: var(--accent-primary);">{t('home.optimizeLogistics')}</span>
          <h2 class="text-6xl md:text-8xl font-black tracking-tighter mb-4 leading-none" style="color: var(--text-primary);">{t('home.mealprep').split('').slice(0,4).join('')}<br/>{t('home.mealprep').split('').slice(4).join('')}</h2>
          <p class="max-w-xs font-medium text-sm leading-relaxed mb-8" style="color: var(--text-secondary);">{t('home.mealPrepDesc')}</p>
          <div class="flex gap-2">
            {['Crockpot', 'No-Cook', 'Freezer'].map(tag => (
              <span class="px-3 py-1 rounded-full text-[10px] uppercase font-bold tracking-widest transition-colors"
                    style="border: 1px solid var(--border-default); color: var(--text-secondary);">{tag}</span>
            ))}
          </div>
        </div>
        <div class="scanner-line opacity-0 group-hover:opacity-100"></div>
      </a>

      <!-- PORTAL 2: HIGH PROTEIN -->
      <a href={`${hpBase}/high-protein/`}
         x-on:mouseenter="activeHub = 'high-protein'"
         x-on:mouseleave="activeHub = 'all'"
         class="relative flex-1 group transition-all duration-700 ease-out flex flex-col justify-end p-12 overflow-hidden"
         x-bind:class="activeHub === 'meal-prep' ? 'opacity-30' : 'opacity-100'">
        <div class="absolute inset-0 transition-colors" style="background-color: var(--bg-secondary);"></div>
        <img src="/images/hero-high-protein.jpg" onerror="this.onerror=null;this.src='/images/placeholder.svg'"
             class="absolute inset-0 w-full h-full object-cover opacity-30 group-hover:opacity-50 transition-opacity duration-700" alt="High Protein" width="1200" height="675" />
        <div class="relative z-10">
          <span class="text-xs font-bold tracking-[0.5em] block mb-4" style="color: var(--accent-primary);">{t('home.optimizeMacros')}</span>
          <h2 class="text-6xl md:text-8xl font-black tracking-tighter mb-4 leading-none" style="color: var(--text-primary);">HIGH<br/>PROTEIN</h2>
          <p class="max-w-xs font-medium text-sm leading-relaxed mb-8" style="color: var(--text-secondary);">{t('home.highProteinDesc')}</p>
          <div class="flex gap-2">
            {['Weight Loss', 'Muscle Gain', 'Bariatric'].map(tag => (
              <span class="px-3 py-1 rounded-full text-[10px] uppercase font-bold tracking-widest transition-colors"
                    style="border: 1px solid var(--border-default); color: var(--text-secondary);">{tag}</span>
            ))}
          </div>
        </div>
        <div class="scanner-line opacity-0 group-hover:opacity-100"></div>
      </a>
    </section>

    <!-- SEARCH & SOLVE WIDGET -->
    <section class="py-20 px-6 max-w-7xl mx-auto" x-data={`{
      goal: '',
      method: '',
      diet: '',
      mpBase: '${mpBase}',
      hpBase: '${hpBase}',
      generateIndex() {
        const goalMap = { 'Weight Loss': 'weight-loss', 'Muscle Gain': 'muscle-gain', 'Healthy': 'healthy' };
        const methodMap = { 'Air Fryer': 'air-fryer', 'Crockpot': 'crockpot', 'No-Cook': 'no-cook', 'Microwave': 'microwave', 'Instant Pot': 'instant-pot', 'Sheet Pan': 'sheet-pan', 'Slow Cooker': 'slow-cooker', 'Freezer': 'freezer', 'Oven': 'oven', 'Grill': 'grill', 'One Pan': 'one-pan' };
        const dietMap = { 'Low Carb': 'low-carb', 'Vegan': 'vegan', 'Keto': 'keto', 'Gluten Free': 'gluten-free', 'Vegetarian': 'vegetarian', 'Dairy Free': 'dairy-free', 'Low Calorie': 'low-calorie' };
        const g = this.goal ? goalMap[this.goal] : null;
        const m = this.method ? methodMap[this.method] : null;
        const d = this.diet ? dietMap[this.diet] : null;
        const parts = [];
        if (m) parts.push('method/' + m);
        if (d) parts.push('diet/' + d);
        if (g) parts.push('goal/' + g);
        if (parts.length >= 2) {
          window.location.href = this.mpBase + '/meal-prep/' + parts[0] + '/' + parts[1] + '/';
        } else if (parts.length === 1) {
          const facet = parts[0];
          const isProtein = facet.startsWith('goal/') || facet.startsWith('diet/');
          window.location.href = (isProtein ? this.hpBase + '/high-protein/' : this.mpBase + '/meal-prep/') + facet + '/';
        } else {
          window.location.href = this.mpBase + '/meal-prep/';
        }
      }
    }`}>
      <div class="flex flex-col md:flex-row items-end justify-between mb-12 gap-8">
        <div class="max-w-xl">
          <div class="flex items-center gap-4 mb-4">
            <div class="h-[1px] w-12" style="background-color: var(--accent-primary);"></div>
            <span class="text-[10px] uppercase font-black tracking-widest" style="color: var(--accent-primary);">{t('home.smartQuery')}</span>
          </div>
          <h3 class="text-4xl font-black tracking-tight leading-none mb-4" style="color: var(--text-primary);">{t('home.systematicSelection')}</h3>
          <p class="font-medium" style="color: var(--text-secondary);">{t('home.systematicDesc')}</p>
        </div>
        <div class="text-right">
          <span class="text-[40px] font-black tabular-nums tracking-tighter block leading-none" style="color: var(--text-primary);">{totalStrategies}</span>
          <span class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--text-secondary);">{t('home.recipesAndPlans')}</span>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 p-4 rounded-2xl"
           style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
        <div class="p-6 rounded-xl flex flex-col justify-between transition-all"
             style="background: var(--select-bg); border: 1px solid var(--select-border);">
          <label class="text-[10px] font-black uppercase tracking-widest mb-6 block" style="color: var(--text-tertiary);">{t('wizard.primaryGoal')}</label>
          <select x-model="goal" class="bg-transparent text-xl font-bold tracking-tight outline-none w-full appearance-none cursor-pointer" style="color: var(--text-primary);">
            <option value="">{t('wizard.anyGoal')}</option>
            <option>Weight Loss</option>
            <option>Muscle Gain</option>
            <option>Healthy</option>
          </select>
        </div>
        <div class="p-6 rounded-xl flex flex-col justify-between transition-all"
             style="background: var(--select-bg); border: 1px solid var(--select-border);">
          <label class="text-[10px] font-black uppercase tracking-widest mb-6 block" style="color: var(--text-tertiary);">{t('wizard.method')}</label>
          <select x-model="method" class="bg-transparent text-xl font-bold tracking-tight outline-none w-full appearance-none cursor-pointer" style="color: var(--text-primary);">
            <option value="">{t('wizard.anyMethod')}</option>
            <option>Air Fryer</option>
            <option>Crockpot</option>
            <option>Slow Cooker</option>
            <option>No-Cook</option>
            <option>Microwave</option>
            <option>Instant Pot</option>
            <option>Sheet Pan</option>
            <option>Freezer</option>
            <option>Oven</option>
            <option>Grill</option>
            <option>One Pan</option>
          </select>
        </div>
        <div class="p-6 rounded-xl flex flex-col justify-between transition-all"
             style="background: var(--select-bg); border: 1px solid var(--select-border);">
          <label class="text-[10px] font-black uppercase tracking-widest mb-6 block" style="color: var(--text-tertiary);">{t('wizard.dietType')}</label>
          <select x-model="diet" class="bg-transparent text-xl font-bold tracking-tight outline-none w-full appearance-none cursor-pointer" style="color: var(--text-primary);">
            <option value="">{t('wizard.anyDiet')}</option>
            <option>Low Carb</option>
            <option>Vegan</option>
            <option>Keto</option>
            <option>Vegetarian</option>
            <option>Gluten Free</option>
            <option>Dairy Free</option>
            <option>Low Calorie</option>
          </select>
        </div>
        <button x-on:click="generateIndex()" class="theme-btn-cta rounded-xl p-6 flex flex-col items-center justify-center transition-all group overflow-hidden relative cursor-pointer">
          <span class="relative z-10 text-xl font-black uppercase tracking-tight">{t('wizard.generateIndex')}</span>
          <span class="relative z-10 text-[10px] font-bold opacity-60">{t('wizard.matchingDataPoints')}</span>
        </button>
      </div>
    </section>

    <!-- TRENDING RECIPES -->
    <section class="py-20 px-6 max-w-7xl mx-auto">
      <div class="flex items-center gap-4 mb-12">
        <div class="h-[2px] w-16" style="background-color: var(--accent-primary);"></div>
        <h3 class="text-xs font-black tracking-[0.5em] uppercase" style="color: var(--text-tertiary);">{t('home.trendingRecipes')}</h3>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Meal Prep Column -->
        <div>
          <h4 class="text-lg font-black tracking-tight mb-6 uppercase" style="color: var(--text-primary);">{t('home.mealPrep')}</h4>
          <div class="space-y-4">
            {featuredMealPrep.map(r => (
              <a href={`${mpBase}/meal-prep/recipes/${r.slug}/`} class="flex gap-4 items-center group p-3 rounded-xl transition-all hover:shadow-md" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                <div class="w-20 h-20 rounded-xl overflow-hidden flex-shrink-0">
                  <img
                    src={`/images/recipes/${r.slug}.jpg`}
                    onerror={`this.onerror=null;this.src='${fallbackImg}'`}
                    alt={r.imageAlt || r.title}
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                    width="80"
                    height="80"
                    loading="lazy"
                  />
                </div>
                <div class="flex-1 min-w-0">
                  <h5 class="font-black text-sm mb-1 truncate group-hover:opacity-80 transition-opacity">{r.title}</h5>
                  <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                    <span>{r.protein}g protein</span>
                    <span>·</span>
                    <span>{r.calories} cal</span>
                    <span>·</span>
                    <span>{r.prepTime + r.cookTime}m</span>
                  </div>
                </div>
              </a>
            ))}
        </div>
        </div>
        <!-- High Protein Column -->
        <div>
          <h4 class="text-lg font-black tracking-tight mb-6 uppercase" style="color: var(--text-primary);">{t('home.highProtein')}</h4>
          <div class="space-y-4">
            {featuredProtein.map(r => (
              <a href={`${hpBase}/high-protein/recipes/${r.slug}/`} class="flex gap-4 items-center group p-3 rounded-xl transition-all hover:shadow-md" style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
                <div class="w-20 h-20 rounded-xl overflow-hidden flex-shrink-0">
                  <img
                    src={`/images/recipes/${r.slug}.jpg`}
                    onerror={`this.onerror=null;this.src='${fallbackImg}'`}
                    alt={r.imageAlt || r.title}
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                    width="80"
                    height="80"
                    loading="lazy"
                  />
                </div>
                <div class="flex-1 min-w-0">
                  <h5 class="font-black text-sm mb-1 truncate group-hover:opacity-80 transition-opacity">{r.title}</h5>
                  <div class="flex gap-3 text-[10px] font-bold" style="color: var(--text-tertiary);">
                    <span>{r.protein}g protein</span>
                    <span>·</span>
                    <span>{r.calories} cal</span>
                    <span>·</span>
                    <span>{r.prepTime + r.cookTime}m</span>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- FACET MEGA-NAV (CHIPS) -->
    <FacetNav chips={facetChips} />

    <!-- TOP CLUSTERS (BENTO GRID) -->
    <section class="py-24 px-6 max-w-7xl mx-auto">
      <h4 class="text-4xl font-black tracking-tighter mb-12" style="color: var(--text-primary);">{t('home.featuredPacks')}</h4>
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <!-- PACK A: HIGH PROTEIN FROZEN -->
        <div class="md:col-span-8 hyper-border rounded-3xl p-8 min-h-[400px] flex flex-col justify-between group overflow-hidden relative">
          <img src="/images/hero-high-protein.jpg" onerror="this.onerror=null;this.src='/images/placeholder.svg'"
               class="absolute inset-0 w-full h-full object-cover opacity-20 group-hover:opacity-30 group-hover:scale-105 transition-all duration-700" alt="High-protein frozen meals and store picks" />
          <div>
            <div class="flex gap-2 mb-6">
              <span class="text-[10px] font-black px-2 py-0.5 rounded uppercase" style="background-color: var(--accent-primary); color: var(--text-inverse);">{t('home.pack01')}</span>
              <span class="text-[10px] font-black px-2 py-0.5 rounded uppercase" style="background: var(--bg-tertiary); color: var(--text-primary);">{t('home.pages150')}</span>
            </div>
            <h5 class="text-5xl font-black tracking-tighter mb-4 leading-none" style="color: var(--text-primary);">{t('home.highProteinFrozen').split('\n')[0]}<br/>{t('home.highProteinFrozen').split('\n')[1] || 'Frozen Index'}</h5>
            <p class="max-w-sm font-medium" style="color: var(--text-secondary);">{t('home.frozenDesc')}</p>
          </div>
          <div class="flex items-center justify-between mt-8 relative z-10">
            <div class="flex -space-x-3">
              {storeBadges.map(badge => (
                <a href={`/stores/${badge.slug}/`} class="w-10 h-10 rounded-full flex items-center justify-center text-[10px] font-bold hover:scale-110 transition-transform"
                     style="background: var(--bg-tertiary); border: 2px solid var(--bg-primary); color: var(--text-primary);">{badge.abbr}</a>
              ))}
            </div>
            <a href="/stores/trader-joes/" class="text-[10px] font-black uppercase tracking-[0.2em] transition-colors flex items-center gap-2" style="color: var(--text-secondary);">
              View Full Pack <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </a>
          </div>
        </div>

        <!-- PACK B: POSTPARTUM -->
        <div class="md:col-span-4 rounded-3xl p-8 flex flex-col justify-between group"
             style="background-color: var(--accent-primary); color: var(--text-inverse); border: 1px solid var(--border-default);">
          <div>
            <div class="flex gap-2 mb-6">
              <span class="text-[10px] font-black px-2 py-0.5 rounded uppercase"
                    style="background: var(--text-primary); color: var(--bg-primary);">{t('home.highSticky')}</span>
            </div>
            <h5 class="text-3xl font-black tracking-tighter mb-4 leading-tight">{t('home.postpartumStash').split('\n')[0]}<br/>{t('home.postpartumStash').split('\n')[1] || 'Freezer Stash'}</h5>
            <p class="font-medium text-sm opacity-70">{t('home.postpartumDesc')}</p>
          </div>
          <div class="mt-8">
            <a href={`${mpBase}/meal-prep/persona/postpartum/`} class="w-full py-4 rounded-xl font-black uppercase text-xs tracking-widest flex items-center justify-center transition-colors"
               style="background: var(--text-primary); color: var(--bg-primary);">
              {t('home.exploreVault')}
            </a>
          </div>
        </div>

        <!-- PACK C: NO MICROWAVE -->
        <a href={`${mpBase}/meal-prep/constraint/no-microwave/`} class="md:col-span-4 hyper-border rounded-3xl p-8 flex flex-col justify-between group block">
          <div class="mb-8">
            <span class="text-[10px] font-black uppercase tracking-widest mb-4 block" style="color: var(--text-tertiary);">{t('home.personaOffice')}</span>
            <h5 class="text-3xl font-black tracking-tighter leading-tight" style="color: var(--text-primary);">{t('home.noMicrowaveLunches')}</h5>
          </div>
          <div class="space-y-4">
            <div class="flex justify-between items-center text-xs font-bold pb-2" style="border-bottom: 1px solid var(--border-default);">
              <span style="color: var(--text-tertiary);">{t('home.constraint')}</span>
              <span style="color: var(--text-primary);">{t('home.coldAmbient')}</span>
            </div>
            <div class="flex justify-between items-center text-xs font-bold pb-2" style="border-bottom: 1px solid var(--border-default);">
              <span style="color: var(--text-tertiary);">{t('home.avgProtein')}</span>
              <span style="color: var(--text-primary);">{avgProtein}g / serving</span>
            </div>
          </div>
        </a>

        <!-- PACK D: FAST FOOD MATRIX -->
        <div class="md:col-span-8 rounded-3xl p-8 flex flex-col md:flex-row gap-8 items-center"
             style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
          <div class="flex-1">
            <h5 class="text-4xl font-black tracking-tighter mb-4" style="color: var(--text-primary);">{t('home.chainGuides')}</h5>
            <p class="text-sm mb-6" style="color: var(--text-secondary);">{t('home.chainDesc')}</p>
            <div class="flex flex-wrap gap-2">
              {fastFoodChains.map(chain => (
                <a href={`/stores/${chain.slug}/`} class="text-[9px] font-black px-2 py-1 rounded transition-colors hover:opacity-80" style="border: 1px solid var(--border-default); color: var(--text-primary);">{chain.name.toUpperCase()}</a>
              ))}
            </div>
          </div>
          <div class="w-full md:w-48 h-48 rounded-2xl flex items-center justify-center p-4"
               style="background: var(--bg-tertiary);">
            <div class="w-full h-full rounded-xl flex flex-col items-center justify-center text-center"
                 style="border: 2px dashed var(--border-default);">
              <span class="text-4xl font-black tracking-tighter" style="color: var(--text-primary);">{recipeCount}</span>
              <span class="text-[8px] font-bold uppercase tracking-widest" style="color: var(--text-tertiary);">Recipes</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FEATURED PLANS (5-DAY PROTOCOL) -->
    <section class="py-24 overflow-hidden" style="background: var(--bg-secondary);">
      <div class="px-6 max-w-7xl mx-auto flex flex-col md:flex-row gap-16 items-center">
        <div class="flex-1">
          <span class="text-[10px] font-black tracking-[0.5em] uppercase mb-4 block" style="color: var(--text-tertiary);">{t('home.retentionModule')}</span>
          <h2 class="text-6xl md:text-8xl font-black tracking-tighter leading-[0.8] mb-8" style="color: var(--text-primary);">THE 5-DAY<br/>PROTOCOL</h2>
          <p class="text-xl font-medium mb-8" style="color: var(--text-secondary);">{t('home.protocolDesc')}</p>
          <div class="flex gap-4">
            <a href={`${mpBase}/meal-prep/plans/beginner-meal-prep-5-day/`} class="theme-btn-primary px-8 py-4 rounded-full font-black uppercase text-xs tracking-widest hover:scale-105 transition-transform inline-block">{t('home.getThePlan')}</a>
            <a href={`${hpBase}/high-protein/plans/high-protein-muscle-gain-5-day/`} class="px-8 py-4 rounded-full font-black uppercase text-xs tracking-widest transition-all inline-block"
                    style="border: 2px solid var(--text-primary); color: var(--text-primary);">{t('home.previewSteps')}</a>
          </div>
        </div>
        <div class="flex-1 relative">
          <div class="p-8 rounded-3xl rotate-3 shadow-2xl relative z-10"
               style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
            <div class="flex items-center justify-between mb-8 pb-4" style="border-bottom: 1px solid var(--border-default);">
              <span class="text-xs font-black tracking-widest" style="color: var(--text-primary);">{t('home.shoppingList')}</span>
              <span class="text-xs font-bold" style="color: var(--text-tertiary);">#P-0042</span>
            </div>
            <div class="space-y-4">
              {shoppingListItems.slice(0, 4).map((item, i) => {
                const done = i === shoppingListItems.length - 1;
                return (
                  <div class="flex items-center gap-4">
                    <div class="w-4 h-4 rounded" style={`border: 2px solid var(--border-strong); ${done ? 'background: var(--text-primary);' : ''}`}></div>
                    <span class="text-sm font-bold" style={done ? 'color: var(--text-tertiary); text-decoration: line-through;' : `color: var(--text-primary);`}>{item}</span>
                  </div>
                );
              })}
            </div>
          </div>
          <div class="absolute top-0 right-0 w-full h-full rounded-3xl -rotate-6 -z-10" style="background-color: var(--accent-primary);"></div>
        </div>
      </div>
    </section>
    <!-- TOOLS & CALCULATORS -->
    <section class="py-24 px-6 max-w-7xl mx-auto">
      <div class="flex items-center gap-4 mb-12">
        <div class="h-[2px] w-16" style="background-color: var(--accent-primary);"></div>
        <h3 class="text-xs font-black tracking-[0.5em] uppercase" style="color: var(--text-tertiary);">{t('home.toolsCalc')}</h3>
      </div>
      <h4 class="text-4xl font-black tracking-tighter mb-12" style="color: var(--text-primary);">{t('home.freeTools')}</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
        <!-- Fridge Finder -->
        <a href="/tools/fridge-finder/" class="group p-6 rounded-2xl transition-all hover:shadow-lg"
           style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
          <div class="flex items-start justify-between mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-all group-hover:scale-110"
                 style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-secondary);">
                <rect x="4" y="2" width="16" height="20" rx="2" />
                <line x1="4" y1="10" x2="20" y2="10" />
                <line x1="9" y1="6" x2="9" y2="8" />
                <line x1="9" y1="14" x2="9" y2="17" />
              </svg>
            </div>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--accent-primary);">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          <h5 class="font-black text-base mb-1 tracking-tight" style="color: var(--text-primary);">{t('tool.fridgeFinder')}</h5>
          <p class="text-xs font-medium" style="color: var(--text-tertiary);">{t('tool.fridgeDesc')}</p>
          <span class="inline-block mt-3 text-[10px] font-black uppercase tracking-widest" style="color: var(--accent-primary);">{t('home.launchTool')}</span>
        </a>

        <!-- Meal Planner -->
        <a href="/tools/meal-planner/" class="group p-6 rounded-2xl transition-all hover:shadow-lg"
           style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
          <div class="flex items-start justify-between mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-all group-hover:scale-110"
                 style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-secondary);">
                <rect x="3" y="4" width="18" height="18" rx="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
                <rect x="7" y="14" width="3" height="3" rx="0.5" />
              </svg>
            </div>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--accent-primary);">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          <h5 class="font-black text-base mb-1 tracking-tight" style="color: var(--text-primary);">{t('tool.mealPlanner')}</h5>
          <p class="text-xs font-medium" style="color: var(--text-tertiary);">{t('tool.mealPlannerDesc')}</p>
          <span class="inline-block mt-3 text-[10px] font-black uppercase tracking-widest" style="color: var(--accent-primary);">{t('home.launchTool')}</span>
        </a>

        <!-- ROI Calculator -->
        <a href="/tools/roi-calculator/" class="group p-6 rounded-2xl transition-all hover:shadow-lg"
           style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
          <div class="flex items-start justify-between mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-all group-hover:scale-110"
                 style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-secondary);">
                <rect x="4" y="2" width="16" height="20" rx="2" />
                <rect x="7" y="5" width="10" height="4" rx="1" />
                <circle cx="8.5" cy="13" r="0.8" fill="currentColor" />
                <circle cx="12" cy="13" r="0.8" fill="currentColor" />
                <circle cx="15.5" cy="13" r="0.8" fill="currentColor" />
                <circle cx="8.5" cy="17" r="0.8" fill="currentColor" />
                <circle cx="12" cy="17" r="0.8" fill="currentColor" />
                <rect x="14.5" y="15.5" width="2" height="3" rx="0.5" fill="currentColor" />
              </svg>
            </div>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--accent-primary);">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          <h5 class="font-black text-base mb-1 tracking-tight" style="color: var(--text-primary);">{t('tool.roiCalc')}</h5>
          <p class="text-xs font-medium" style="color: var(--text-tertiary);">{t('tool.roiCalcDesc')}</p>
          <span class="inline-block mt-3 text-[10px] font-black uppercase tracking-widest" style="color: var(--accent-primary);">{t('home.launchTool')}</span>
        </a>

        <!-- Protein Cost Ranker -->
        <a href="/tools/protein-cost/" class="group p-6 rounded-2xl transition-all hover:shadow-lg"
           style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
          <div class="flex items-start justify-between mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-all group-hover:scale-110"
                 style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-secondary);">
                <rect x="3" y="14" width="5" height="8" rx="1" />
                <rect x="9.5" y="8" width="5" height="14" rx="1" />
                <rect x="16" y="3" width="5" height="19" rx="1" />
                <path d="M18.5 6l-1-2h3l-1 2" stroke-width="1" />
              </svg>
            </div>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--accent-primary);">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          <h5 class="font-black text-base mb-1 tracking-tight" style="color: var(--text-primary);">{t('tool.proteinCost')}</h5>
          <p class="text-xs font-medium" style="color: var(--text-tertiary);">{t('tool.proteinCostDesc')}</p>
          <span class="inline-block mt-3 text-[10px] font-black uppercase tracking-widest" style="color: var(--accent-primary);">{t('home.launchTool')}</span>
        </a>

        <!-- Prep Quiz -->
        <a href="/tools/prep-quiz/" class="group p-6 rounded-2xl transition-all hover:shadow-lg"
           style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
          <div class="flex items-start justify-between mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-all group-hover:scale-110"
                 style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-secondary);">
                <circle cx="12" cy="12" r="10" />
                <path d="M9 9a3 3 0 115.12 2.13c-.58.49-1.12 1.08-1.12 1.87v.5" />
                <circle cx="12" cy="17" r="0.8" fill="currentColor" />
              </svg>
            </div>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--accent-primary);">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          <h5 class="font-black text-base mb-1 tracking-tight" style="color: var(--text-primary);">{t('tool.prepQuiz')}</h5>
          <p class="text-xs font-medium" style="color: var(--text-tertiary);">{t('tool.prepQuizDesc')}</p>
          <span class="inline-block mt-3 text-[10px] font-black uppercase tracking-widest" style="color: var(--accent-primary);">{t('home.launchTool')}</span>
        </a>

        <!-- Nutrition Label -->
        <a href="/tools/nutrition-label/" class="group p-6 rounded-2xl transition-all hover:shadow-lg"
           style="background: var(--bg-secondary); border: 1px solid var(--border-default);">
          <div class="flex items-start justify-between mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-all group-hover:scale-110"
                 style="background: var(--bg-tertiary); border: 1px solid var(--border-default);">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-secondary);">
                <rect x="5" y="2" width="14" height="20" rx="2" />
                <line x1="8" y1="6" x2="16" y2="6" />
                <line x1="8" y1="9" x2="14" y2="9" />
                <line x1="5" y1="12" x2="19" y2="12" stroke-width="2" />
                <line x1="8" y1="15" x2="12" y2="15" />
                <line x1="8" y1="18" x2="16" y2="18" />
              </svg>
            </div>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--accent-primary);">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          <h5 class="font-black text-base mb-1 tracking-tight" style="color: var(--text-primary);">{t('tool.nutritionLabel')}</h5>
          <p class="text-xs font-medium" style="color: var(--text-tertiary);">{t('tool.nutritionLabelDesc')}</p>
          <span class="inline-block mt-3 text-[10px] font-black uppercase tracking-widest" style="color: var(--accent-primary);">{t('home.launchTool')}</span>
        </a>
      </div>
      <div class="flex justify-center">
        <a href="/tools/" class="inline-flex items-center gap-3 px-8 py-4 rounded-full font-black uppercase text-xs tracking-widest transition-all hover:scale-105"
           style="border: 2px solid var(--text-primary); color: var(--text-primary);">
          {t('home.viewAllTools')}
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>
    </section>
  </main>

  <FooterNav site={site} />
</BaseLayout>
